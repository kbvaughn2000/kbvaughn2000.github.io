<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="Tech_Supp0rt: 1 Tech_Supp0rt: 1 is an easy rated box on Try Hack Me.
Hints Room Hints Enumerate all the services available Have you found both CMS platforms? CyberChef will help you out GTFOBins will help with privilege escalation Walkthrough Full Walkthrough Task 1 - Uncover the root.txt file First, let&rsquo;s enumerate the open ports with:
threader3000
Once complete, let it complete it&rsquo;s recommended nmap scan.
It appears that there&rsquo;s a website running on port 80, and SMB is also open."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Tech_Supp0rt: 1"><meta name=twitter:description content="Tech_Supp0rt: 1 Tech_Supp0rt: 1 is an easy rated box on Try Hack Me.
Hints Room Hints Enumerate all the services available Have you found both CMS platforms? CyberChef will help you out GTFOBins will help with privilege escalation Walkthrough Full Walkthrough Task 1 - Uncover the root.txt file First, let&rsquo;s enumerate the open ports with:
threader3000
Once complete, let it complete it&rsquo;s recommended nmap scan.
It appears that there&rsquo;s a website running on port 80, and SMB is also open."><meta property="og:title" content="Tech_Supp0rt: 1"><meta property="og:description" content="Tech_Supp0rt: 1 Tech_Supp0rt: 1 is an easy rated box on Try Hack Me.
Hints Room Hints Enumerate all the services available Have you found both CMS platforms? CyberChef will help you out GTFOBins will help with privilege escalation Walkthrough Full Walkthrough Task 1 - Uncover the root.txt file First, let&rsquo;s enumerate the open ports with:
threader3000
Once complete, let it complete it&rsquo;s recommended nmap scan.
It appears that there&rsquo;s a website running on port 80, and SMB is also open."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2022-06-02-techsupp0rt1/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2022-06-02T00:00:00+00:00"><meta property="article:modified_time" content="2022-06-02T00:00:00+00:00"><title>Tech_Supp0rt: 1 · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2022-06-02-techsupp0rt1/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.b22741cfb7d009582dcb2522a0999af7784eecc489bab6c6a143d5ce43b36f25.css integrity="sha256-sidBz7fQCVgtyyUioJma93hO7MSJurbGoUPVzkOzbyU=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.111.1"></head><body class="preload-transitions colorscheme-light"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2022-06-02-techsupp0rt1/>Tech_Supp0rt: 1</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2022-06-02T00:00:00Z>June 2, 2022</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/rce/>RCE</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/file-upload/>file upload</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/try-hack-me/>Try Hack Me</a></span></div></div></header><div><h1 id=tech_supp0rt-1>Tech_Supp0rt: 1
<a class=heading-link href=#tech_supp0rt-1><i class="fa fa-link" aria-hidden=true></i></a></h1><p>Tech_Supp0rt: 1 is an easy rated box on <a href=https://tryhackme.com/room/techsupp0rt1>Try Hack Me</a>.</p><h2 id=hints>Hints
<a class=heading-link href=#hints><i class="fa fa-link" aria-hidden=true></i></a></h2><details><summary><strong>Room Hints</strong></summary><ul><li>Enumerate all the services available<li>Have you found both CMS platforms?<li>CyberChef will help you out<li>GTFOBins will help with privilege escalation</ul></details><h2 id=walkthrough>Walkthrough
<a class=heading-link href=#walkthrough><i class="fa fa-link" aria-hidden=true></i></a></h2><details><summary><strong>Full Walkthrough</strong></summary><h3 id=task-1---uncover-the-roottxt-file>Task 1 - Uncover the root.txt file
<a class=heading-link href=#task-1---uncover-the-roottxt-file><i class="fa fa-link" aria-hidden=true></i></a></h3><p>First, let&rsquo;s enumerate the open ports with:</p><p><code>threader3000</code></p><p><img src=/assets/img/TechSupp0rt1.png alt="TechSupp0rt1 threader3000"></p><p>Once complete, let it complete it&rsquo;s recommended nmap scan.</p><p><img src=/assets/img/TechSupp0rt2.png alt="TechSupp0rt1 nmap"></p><p>It appears that there&rsquo;s a website running on port 80, and SMB is also open. Based on the Windows version listed (6.1, which is Windows 7) this might be vulnerable to various SMB attacks, most notably EternalBlue. Let&rsquo;s perform some enumeration on SMB to start with.</p><p>First, let&rsquo;s enumerate shares with smbclient as an anonymous user with the following command:</p><p><code>smbclient -L &lt;ip address></code></p><p><img src=/assets/img/TechSupp0rt3.png alt="TechSupp0rt1 smb share enum"></p><p>It appears that there&rsquo;s a share named websvr, let&rsquo;s see if we have any access to it by utilizing smbmap:</p><p><code>smbmap &lt;ip address></code></p><p><img src=/assets/img/TechSupp0rt4.png alt="TechSupp0rt1 smbmap"></p><p>Now that we know we have read access, let&rsquo;s connect to this share with smbclient with the following command:</p><p><code>smbclient \\\\&lt;ip address>\\websvr</code></p><p><img src=/assets/img/TechSupp0rt5.png alt="TechSupp0rt1 smbclient websvr"></p><p>Next, let&rsquo;s list the contents of the folder we connected to and we&rsquo;ll see a file named <strong>enter.txt</strong>. Let&rsquo;s download that file to our local machine with:</p><p><code>get enter.txt</code></p><p><img src=/assets/img/TechSupp0rt6.png alt="TechSupp0rt1 smbclient enter.txt"></p><p>Reviewing the contents of the file, we have what appears to be credentials to the subiron CMS. The password appears to be encoded:</p><p><img src=/assets/img/TechSupp0rt7.png alt="TechSupp0rt1 enter.txt creds"></p><p>Let&rsquo;s use <a href=https://gchq.github.io/CyberChef/>CyberChef</a> to attempt to decode this. After some trial and error, I found that decoding this with Base58, followed by Base32 and finally Base64 will provide you with the password.</p><p><img src=/assets/img/TechSupp0rt8.png alt="TechSupp0rt1 cyberchef decode"></p><p>According to the documentation /subrion does not work for the Subrion CMS that they appear to be using, so let&rsquo;s use dirsearch to attempt to find the directory that was utilized:</p><p><code>dirsearch -u http://&lt;ip address></code></p><p>Results similar to the following should appear.</p><p><img src=/assets/img/TechSupp0rt9.png alt="TechSupp0rt1 dirsearch"></p><p>Visiting the phpinfo.php page provides info on which version of PHP and what extensions or running.</p><p><img src=/assets/img/TechSupp0rt10.png alt="TechSupp0rt1 phpinfo"></p><p>Let&rsquo;s next take a look at the /test directory. This appears to be a template for a tech support scammer&rsquo;s site:</p><p><img src=/assets/img/TechSupp0rt11.png alt="TechSupp0rt1 /test"></p><p>Next, I returned to the note, which mentioned that /subrion was not working and to login to the panel. I decided to attempt to enumerate the /subrion directory:</p><p><code>dirsearch -u http://&lt;ip address>/subrion</code></p><p>This returned a ton of 302 (redirects), but there were also a few other files within the results, including robots.txt</p><p><img src=/assets/img/TechSupp0rt12.png alt="TechSupp0rt1 subrion dirsearch robots.txt"></p><p>I visited this page and it listed a few directories that potentially contained useful information:</p><p><img src=/assets/img/TechSupp0rt13.png alt="TechSupp0rt1 subrion robots.txt"></p><p>I noticed there was a /panel/ directory, and panel was mentioned before, so I navigated to the /subrion/panel directory to see what happens, and was presented with a login page.</p><p><img src=/assets/img/TechSupp0rt14.png alt="TechSupp0rt1 subrion login"></p><p>I logged in with the credentials discovered earlier in the enter.txt file:</p><p><img src=/assets/img/TechSupp0rt15.png alt="TechSupp0rt1 subrion admin page"></p><p>As shown in this picture, the version of Subrion is 4.2.1, which has an authenticated file upload bypass <a href=https://www.exploit-db.com/exploits/49876>exploit</a></p><p><img src=/assets/img/TechSupp0rt16.png alt="TechSupp0rt1 subrion exploit"></p><p>Let&rsquo;s take a look at this exploit and see what we can do with it. It appears that all we have to supply is the URL to subrion&rsquo;s admin panel, along with the username and password we uncovered earlier. Let&rsquo;s give it a shot with:</p><p><code>python3 exploit.py -u http://&lt;ip address>/subrion/panel/ -l admin -p &lt;redacted></code></p><p>We now have a web shell to this system!</p><p><img src=/assets/img/TechSupp0rt17.png alt="TechSupp0rt1 www-data shell"></p><p>Next, let&rsquo;s look at the current directory we&rsquo;re in with <code>pwd</code>. It appears that we&rsquo;re in the /var/www/html/subrion/uploads directory. We know that Wordpress is also running, so let&rsquo;s run:</p><p><code>ls ../../wordpress</code></p><p>This will show you the contents of this directory, where a wp-config.php file is present.</p><p><img src=/assets/img/TechSupp0rt18.png alt="TechSupp0rt1 wordpress-config.php"></p><p>Let&rsquo;s view the contents with:</p><p><code>cat ../../wordpress/wp-config.php</code></p><p>In the file we will locate database credentials:</p><p><img src=/assets/img/TechSupp0rt19.png alt="TechSupp0rt1 wordpress-config.php creds"></p><p>Let&rsquo;s see if we can use these same credentials to login via SSH. First, let&rsquo;s run</p><p><code>ls /home</code></p><p>to enumerate users on the system. There is one user listed (scamsite):</p><p><img src=/assets/img/TechSupp0rt20.png alt="TechSupp0rt1 enumerate /home"></p><p>In another terminal window, let&rsquo;s try logging in as the scamsite user with the password previously discovered:</p><p><img src=/assets/img/TechSupp0rt21.png alt="TechSupp0rt1 ssh login"></p><p>It looks like we&rsquo;re logged in as the scamsite user now. Let&rsquo;s see if they have any access with sudo to run another program as root with:</p><p><code>sudo -l</code></p><p>There is one binary listed <strong>/usr/bin/iconv</strong> Let&rsquo;s look at <a href=https://gtfobins.github.io/gtfobins/iconv/>GTFOBins</a>.</p><p><img src=/assets/img/TechSupp0rt22.png alt="TechSupp0rt1 GTFOBins"></p><p>Let&rsquo;s test this out and see if we can view the authorized keys file for the root user with</p><p><code>sudo /usr/bin/iconv -f 8859_1 -t 8859_1 "/root/.ssh/id_rsa.pub"</code></p><p><img src=/assets/img/TechSupp0rt23.png alt="TechSupp0rt1 view root id_rsa.pub"></p><p>Since we can run iconv as sudo, we can also use it to write to a file. Find your attacker machines id_rsa.pub file and then do the following:</p><p><code>echo &lt;your id_rsa.pub>|sudo /usr/bin/iconv -f 8859_1 -t 8859_1 -o "/root/.ssh/authorized_keys"</code></p><p><img src=/assets/img/TechSupp0rt24.png alt="TechSupp0rt1 view add to root authorized_keys"></p><p>Now, we should be able to use our private rsa key to login to the box as root with:</p><p>ssh root@&lt;ip> -i id_rsa</p><p><img src=/assets/img/TechSupp0rt25.png alt="TechSupp0rt1 root shell"></p><p>Next, let&rsquo;s list the directory contents and then the contents of the root.txt file:</p><p><img src=/assets/img/TechSupp0rt26.png alt="TechSupp0rt1 root flag"></p></details></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2023
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>