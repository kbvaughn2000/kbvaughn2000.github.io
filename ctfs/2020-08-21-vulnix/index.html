<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="HackLAB: Vulnix a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next, I ran threader3000 to let is enumerate the open ports."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HackLAB: Vulnix"><meta name=twitter:description content="HackLAB: Vulnix a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next, I ran threader3000 to let is enumerate the open ports."><meta property="og:title" content="HackLAB: Vulnix"><meta property="og:description" content="HackLAB: Vulnix a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next, I ran threader3000 to let is enumerate the open ports."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-08-21-vulnix/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-08-21T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-21T00:00:00+00:00"><title>HackLAB: Vulnix · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-08-21-vulnix/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.98.0"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-08-21-vulnix/>HackLAB: Vulnix</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-08-21T00:00:00Z>August 21, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/oscp/>OSCP</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/smtp/>smtp</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/finger/>finger</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/nfs/>nfs</a></span></div></div></header><div><p><a href=https://www.vulnhub.com/entry/hacklab-vulnix,48/>HackLAB: Vulnix</a> a vulnerable machine found on the <a href="https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=0">NetSecFocus Trophy Room</a> list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.</p><p>First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used <strong>netdiscover -i eth0</strong> until I came across the IP of this machine.</p><p><img src=/assets/img/Vulnix1.png alt="Vulnix netdiscover"></p><p>Next, I ran <strong>threader3000</strong> to let is enumerate the open ports. I also let it run it&rsquo;s recommended nmap scan.</p><p><img src=/assets/img/Vulnix2.png alt="Vulnix threader3000"></p><p><img src=/assets/img/Vulnix3.png alt="Vulnix nmap 1"></p><p><img src=/assets/img/Vulnix4.png alt="Vulnix nmap 2"></p><p>As you can see, there were several ports open. I looked into seeing how I could exploit SMTP first. It appears we can run <strong>VRFY</strong> on SMTP, which we can use to enumerate users. I ran <strong>smtp-user-enum -M VRFY -U /usr/share/wordlists/smtp-usernames.txt -t [machine ip]</strong> to start enumeration. I used <a href=https://github.com/pentestmonkey/yaptest/blob/master/smtp-usernames.txt>this</a> list of SMTP usernames for enumeration.</p><p><img src=/assets/img/Vulnix5.png alt="Vulnix smpt-user-enum"></p><p>As you can tell, several users came back. I next used finger and was able to determine two users <strong>root</strong> and <strong>user</strong>. This was done by running <strong>finger [username]@[machine ip]</strong></p><p><img src=/assets/img/Vulnix6.png alt="Vulnix finger"></p><p>At this point, I had a couple of usernames to go off of, so I decided to attempt to brute force the user SSH credentials (as I felt the root ones were likely secure as it would make this box pointless otherwise). I ran <strong>hydra -l user -P /usr/share/wordlists/rockyou.txt [machine ip] -t 4 ssh</strong> and after about 15 minutes the user account password was cracked as shown below.</p><p><img src=/assets/img/Vulnix7.png alt="Vulnix hydra ssh brute force"></p><p>I tried <strong>sudo -l</strong>, but user was not able to run sudo commands. I next ran <strong>cd /home</strong> followed by <strong>ls -al</strong> to enumerate the home users folder, and there was another user directory present, <strong>vulnix</strong>. I ran <strong>id vulnix</strong> to attain more information about its user id.</p><p><img src=/assets/img/Vulnix8.png alt="Vulnix user enumeration"></p><p>Next, I decided to attempt to remotely connect to the victim PC over NFS. In order to do so, I create da vulnix user on my attacker machine with the same ID # with <strong>useradd -u 2008 vulnix</strong>. I then created a folder to mount the target machine to with <strong>mkdir /tmp/vulnix</strong>. Finally, I mounted the /home/vulnix directory on the target machine to /tmp/vulnix on my attacker machine with <strong>mount -t nfs [machine ip]:/home/vulnix /tmp/vulnix -nolock</strong>.</p><p>I then ran <strong>cd /tmp/vulnix</strong> followed by <strong>ls -al</strong> and I was able to see the vulnix user&rsquo;s home directory</p><p><img src=/assets/img/Vulnix9.png alt="Vulnix nfs mount"></p><p>You can use SSH to connect two ways, with a password or with a certificate. I decided to generate a new set of SSH keys on my attacker pc as root with <strong>ssh-keygen</strong> after opening a new terminal window.</p><p><img src=/assets/img/Vulnix10.png alt="Vulnix root ssh-keygen"></p><p>Next, I ran <strong>cd /root/.ssh</strong> followed by <strong>ls</strong> to ensure the files were generated. I then ran <strong>cat id_rsa.pub</strong> to get the contents for root&rsquo;s public key, which I copied.</p><p><img src=/assets/img/Vulnix11.png alt="Vulnix public RSA key"></p><p>Back on my victim session over NFS, I ran <strong>mkdir .ssh</strong> followed by <strong>cd .ssh</strong> and finally <strong>touch authorized_keys</strong>. This was going to be the file I pasted in my root public SSH key to.</p><p><img src=/assets/img/Vulnix12.png alt="Vulnix vulnix .ssh folder"></p><p>In order to do so, I ran <strong>vi authorized_keys</strong> and pasted in the key value. Once completed, I pressed escape, and entered <strong>:wq!</strong> to write to the authorized_keys file and quit vi.</p><p><img src=/assets/img/Vulnix13.png alt="Vulnix vi authorized_keys"></p><p>Now, back on my attacker PC, I ran <strong>ssh vulnix@[machine ip]</strong>. I was now connected as the vulnix user!</p><p><img src=/assets/img/Vulnix14.png alt="Vulnix ssh vulnix"></p><p>I ran <strong>sudo -l</strong>, which showed that vulnix could run <strong>sudoedit /etc/exports</strong> as root with no password.</p><p><img src=/assets/img/Vulnix15.png alt="Vulnix vulnix sudo -l"></p><p>This showed that the /home/vulnix directory had root_squash set, which disallows mounting NFS as root. I modified this to <strong>no_root_squash</strong> as shown below and added in <strong>/root *(rw,no_root_squash)</strong> as well, which should allow access to the <strong>/root folder</strong>.</p><p><img src=/assets/img/Vulnix16.png alt="Vulnix /etc/exports modification"></p><p>Next, I rebooted the system in VMWare as recommended in the official creator&rsquo;s writeup (as I couldn&rsquo;t find another way to reboot the system). This allows the NFS changes to take place shown above. Next, I ran <strong>umount /tmp/vulnix</strong> to unmount the /home/vulnix nfs share and then ran <strong>mount -t nfs [machine ip]:/root /tmp/vulnix</strong> to mount the <strong>/root</strong> folder to the share. I then ran <strong>cd /tmp/vulnix</strong> followed by <strong>ls</strong> and the flag file, trophy.txt is present. I finished this box by running <strong>cat trophy.txt</strong>.</p><p><img src=/assets/img/Vulnix17.png alt=Vulnix></p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2022
Kiel Vaughn</section></footer></main><script src=/js/coder.min.f453d26c79f010446cf0d9770197f77de32c07b7a5512d141a286247fe154a22.js integrity="sha256-9FPSbHnwEERs8Nl3AZf3feMsB7elUS0UGihiR/4VSiI="></script></body></html>