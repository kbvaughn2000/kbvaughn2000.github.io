<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="Haskhell is a medium difficulty box from TryHackme. Below are the steps involved to fully compromise this box.
First, let&rsquo;s see what ports are open by running threader3000 and entering the IP address of our victim.
Next, let&rsquo;s run nmap -A -p 22,5001 [machine ip] to further enumerate these ports to see what is running. We ran threader first as it is able to find open TCP ports quickly, which in turn allows us to narrow the range that nmap is scanning, which speeds up its runtime as well."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content=" Haskhell - TryHackMe"><meta name=twitter:description content="Haskhell is a medium difficulty box from TryHackme. Below are the steps involved to fully compromise this box.
First, let&rsquo;s see what ports are open by running threader3000 and entering the IP address of our victim.
Next, let&rsquo;s run nmap -A -p 22,5001 [machine ip] to further enumerate these ports to see what is running. We ran threader first as it is able to find open TCP ports quickly, which in turn allows us to narrow the range that nmap is scanning, which speeds up its runtime as well."><meta property="og:title" content=" Haskhell - TryHackMe"><meta property="og:description" content="Haskhell is a medium difficulty box from TryHackme. Below are the steps involved to fully compromise this box.
First, let&rsquo;s see what ports are open by running threader3000 and entering the IP address of our victim.
Next, let&rsquo;s run nmap -A -p 22,5001 [machine ip] to further enumerate these ports to see what is running. We ran threader first as it is able to find open TCP ports quickly, which in turn allows us to narrow the range that nmap is scanning, which speeds up its runtime as well."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-07-19-haskhell/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-07-19T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-19T00:00:00+00:00"><title>Haskhell - TryHackMe · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-07-19-haskhell/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.106.0"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-07-19-haskhell/>Haskhell - TryHackMe</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-07-19T00:00:00Z>July 19, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
3-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/haskhell/>Haskhell</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/tryhackme/>TryHackMe</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/haskell-scripting/>Haskell scripting</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/flask-privesc/>flask privesc</a></span></div></div></header><div><p>Haskhell is a medium difficulty box from <a href=https://www.tryhackme.com>TryHackme</a>. Below are the steps involved to fully compromise this box.</p><p>First, let&rsquo;s see what ports are open by running <strong>threader3000</strong> and entering the IP address of our victim.</p><p><img src=/assets/img/Haskhell1.png alt="Haskhell threader3000"></p><p>Next, let&rsquo;s run <strong>nmap -A -p 22,5001 [machine ip]</strong> to further enumerate these ports to see what is running. We ran threader first as it is able to find open TCP ports quickly, which in turn allows us to narrow the range that nmap is scanning, which speeds up its runtime as well.</p><p><img src=/assets/img/Haskhell2.png alt="Haskhell nmap"></p><p>It appears that port 5001 is hosting a web server. Let&rsquo;s open that up and take a look around.</p><p><img src=/assets/img/Haskhell3.png alt="Haskhell web page"></p><p>This page appears to be a professor&rsquo;s site for students to submit their assignments. Following the links eventually gets you to an upload page that does not appear to be functioning or there.</p><p><img src=/assets/img/Haskhell4.png alt="Haskhell upload"></p><p>Let&rsquo;s enumerate the website by running <strong>gobuster dir -u http://[machine ip]:5001 -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-small.txt -t 50</strong></p><p><img src=/assets/img/Haskhell5.png alt="Haskhell gobuster"></p><p>It appears that it found another directory named <strong>/submit</strong>. Let&rsquo;s take a look at that in our browser.</p><p><img src=/assets/img/Haskhell6.png alt="Haskhell submit"></p><p>This appears to be the page where you are allowed to submit your assignments. I was able to upload a <a href=http://pentestmonkey.net/tools/web-shells/php-reverse-shell>PHP reverse shell</a>, but there was no indication of where the file was saved. I decided to go review the initial web page again, and noticed something I had overlooked previously.</p><p><img src=/assets/img/Haskhell8.png alt="Haskhell website revisited"></p><p>Clicking on the link to the first assignment also tells you that only Haskell files are accepted for uploads. It also tells you where the files are uploaded to (the uploads directory)</p><p><img src=/assets/img/Haskhell9.png alt=.></p><p>With this information, I looked into ways to pull information off of a Linux system with a Haskell file. After a bit of research, I was able to find a sample for displaying contents of a file with a Haskell script <a href=http://learnyouahaskell.com/input-and-output>here</a>.</p><p><img src=/assets/img/Haskhell10.png alt="Haskhell sample Haskell code"></p><p>I copied this code and modified it to display /etc/passwd instead, so we could enumerate users on the system.</p><p><img src=/assets/img/Haskhell11.png alt="Haskhell haskell.hs"></p><p>Next, I went back to the <strong>/submit</strong> page and uploaded the file to see what would happen.</p><p><img src=/assets/img/Haskhell12.png alt="Haskhell /etc/passwd"></p><p>Awesome, we were able to enumerate the users on the system. Let&rsquo;s modify this script to attempt to display both <strong>/home/flask/user.txt</strong> and <strong>/home/prof/user.txt</strong> to get the user flag.</p><p><img src=/assets/img/Haskhell14.png alt="Haskhell script v2"></p><p>This provided me with the user flag, which appeared to be under the <strong>prof</strong> user&rsquo;s home directory</p><p><img src=/assets/img/Haskhell15.png alt="Haskhell user.txt"></p><p>I also attempted this with root/root.txt, which received an access denied error. Going back to the initial scanning, I realized that ssh was open. Let&rsquo;s see if either of these users have a SSH key available.
<img src=/assets/img/Haskhell16.png alt="Haskhell retrieve ssh keys"></p><p><img src=/assets/img/Haskhell17.png alt="Haskhell prof SSH key"></p><p>Awesome, the <strong>prof</strong> user has an SSH key. Let&rsquo;s save that to a file on our attacker computer named <strong>prof.key</strong>, and run <strong>chmod 600 prof.key</strong> on that key.</p><p><img src=/assets/img/Haskhell18.png alt="Haskhell save prof.key"></p><p>Next, we need to crack this file with john to retrieve the key&rsquo;s password. This is done by running <strong>python /usr/share/john/ssh2john.py prof.key > prof.hash</strong>.</p><p>This will tell you that this key does not have a password. Great!</p><p><img src=/assets/img/Haskhell20.png alt="Haskhell private key no password"></p><p>Let&rsquo;s connect as prof with <strong>ssh -i prof.key prof@[machine ip]</strong>. You should now have an ssh connection as prof.</p><p><img src=/assets/img/Haskhell21.png alt="Haskhell prof SSH connection"></p><p>Running <strong>sudo -l</strong> lets you know that prof can run flask as root.</p><p><img src=/assets/img/Haskhell22.png alt="Haskhell prof sudo -l"></p><p>Great, we should be able to obtain a root shell with a relatively simple python script. Let&rsquo;s run <strong>nano shell.py</strong> and put in the code shown in the screenshot below.</p><p><img src=/assets/img/Haskhell23.png alt="Haskhell python script"></p><p>Now, let&rsquo;s run <strong>sudo /usr/bin/flask run</strong>. We end up getting an error stating that there is not a FLASK_APP environment variable.</p><p><img src=/assets/img/Haskhell24.png alt="Haskhell run flask"></p><p>Let&rsquo;s set a FLASK_APP environment variable with <strong>export FLASK_APP=/home/prof/shell.py</strong>.</p><p><img src=/assets/img/Haskhell25.png alt="Haskhell FLASK_APP env variable"></p><p>Now, let&rsquo;s run <strong>sudo /usr/bin/flask run</strong> again and see what happens.</p><p><img src=/assets/img/Haskhell26.png alt="Haskhell root shell"></p><p>We now have root access! Let&rsquo;s run <strong>cat /root/root.txt</strong> to complete this box</p><p><img src=/assets/img/Haskhell27.png alt="Haskhell root.txt"></p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2022
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>