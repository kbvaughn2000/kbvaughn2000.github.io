<!DOCTYPE html>
<html lang="en" data-theme="amber">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} | {{ .Site.Title }}{{ end }}</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ "css/style.css" | relURL }}">
    
    <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/pagefind/pagefind-ui.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/base16/dracula.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>

<body>
    <div class="site-wrapper">
        <div class="container">
            <header class="site-header" data-pagefind-ignore>
                <div class="nav-left">
                    <a href="/" class="nav-item">~/<span class="cursor"></span>&nbsp;</a>
                </div>

                <input type="checkbox" id="menu-toggle" class="menu-toggle" style="display: none;">
                <label for="menu-toggle" class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </label>

                <nav class="nav-right site-nav">
                    {{ range .Site.Menus.main }}
                        <span class="nav-separator">></span>
                        <a href="{{ .URL | relURL }}" class="nav-item">{{ .Name }}</a>
                    {{ end }}
    
                    <span class="nav-separator">></span>
                    <a href="#" class="terminal-button-small search-nav-item" id="search-trigger" title="EXEC_SEARCH">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </a>
    
                    <span class="nav-separator">|</span>
                    <button id="theme-toggle" class="terminal-button-small" title="Toggle Terminal Theme">
                        <i class="fa-solid fa-desktop"></i>
                    </button>
                </nav>
            </header>

            <main>
                {{ block "main" . }}{{ end }}
            </main>
        </div>

        <footer class="terminal-footer" data-pagefind-ignore>
            <div class="container">
                <div class="footer-content">
                    <div class="footer-left">
                        <span class="copyright">
                            &copy; 2020â€“{{ now.Format "2006" }} [ Kiel Vaughn ] // ALL_RIGHTS_RESERVED
                        </span>
                    </div>
                    <div class="system-status">
                        <span class="status-indicator"></span> SYSTEM_STABLE
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <div id="search-overlay" class="search-modal" style="display: none;">
        <div class="search-container">
            <div class="search-header">
                <span class="primary">> EXEC_SEARCH_QUERY...</span>
                <button id="search-close" class="terminal-button-small" style="font-size: 0.8rem;">[ ESC ]</button>
            </div>
            <div id="search-ui"></div> 
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            /* --- THEME TOGGLE LOGIC --- */
            const themeToggle = document.getElementById('theme-toggle');
            const themes = ['amber', 'green', 'white'];
            
            let currentTheme = localStorage.getItem('selected-theme') || 'amber';
            document.documentElement.setAttribute('data-theme', currentTheme);

            themeToggle.addEventListener('click', () => {
                let index = themes.indexOf(currentTheme);
                index = (index + 1) % themes.length;
                currentTheme = themes[index];
                document.documentElement.setAttribute('data-theme', currentTheme);
                localStorage.setItem('selected-theme', currentTheme);
            });

            /* --- SEARCH OVERLAY LOGIC --- */
            const searchTrigger = document.getElementById('search-trigger');
            const searchOverlay = document.getElementById('search-overlay');
            const searchClose = document.getElementById('search-close');
            const body = document.body;

            if (typeof PagefindUI !== 'undefined') {
                new PagefindUI({ 
                    element: "#search-ui", 
                    showSubResults: true,
                    showImages: false,
                    resetStyles: false 
                });
            }

            searchTrigger.addEventListener('click', (e) => {
                e.preventDefault();
                const blogContent = document.getElementById('blog-content');
                if (blogContent) { blogContent.style.visibility = 'hidden'; }
                body.classList.add('search-open');
                searchOverlay.style.display = 'block';
                setTimeout(() => {
                    const input = document.querySelector('.pagefind-ui__search-input');
                    if (input) input.focus();
                }, 100);
            });

            const closeSearch = () => {
                const blogContent = document.getElementById('blog-content');
                if (blogContent) { blogContent.style.visibility = 'visible'; }
                body.classList.remove('search-open');
                searchOverlay.style.display = 'none';
            };

            searchClose.addEventListener('click', closeSearch);
            window.addEventListener('keydown', (e) => { if (e.key === "Escape") closeSearch(); });
            searchOverlay.addEventListener('click', (e) => { if (e.target === searchOverlay) closeSearch(); });
        });
    </script>
    <script src="/js/main.js"></script>
</body>
</html>
